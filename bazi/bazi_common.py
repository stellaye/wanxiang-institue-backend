import copy
import sys
import sxtwl
import time
from pprint import pprint
from datetime import datetime, timedelta
import json
import traceback
from consts.jieqi import jieqi_days
import copy
import math

jieqi_names = [
    "立春",
    "惊蛰",
    "清明",
    "立夏",
    "芒种",
    "小暑",
    "立秋",
    "白露",
    "寒露",
    "立冬",
    "大雪",
    "小寒",
]


tiangan_start_map = {
    0: 2,  # 甲己年，寅月天干为丙（index 2）
    5: 2,  # 甲己年，寅月天干为丙（index 2）
    1: 4,  # 乙庚年，寅月天干为戊（index 4）
    6: 4,  # 乙庚年，寅月天干为戊（index 4）
    2: 6,  # 丙辛年，寅月天干为庚（index 6）
    7: 6,  # 丙辛年，寅月天干为庚（index 6）
    3: 8,  # 丁壬年，寅月天干为壬（index 8）
    8: 8,  # 丁壬年，寅月天干为壬（index 8）
    4: 0,  # 戊癸年，寅月天干为甲（index 0）
    9: 0,  # 戊癸年，寅月天干为甲（index 0）
}

shishenSimplifierDict = {
    "七杀": "杀",
    "正官": "官",
    "偏印": "枭",
    "正印": "印",
    "食神": "食",
    "伤官": "伤",
    "比肩": "比",
    "劫财": "劫",
    "偏财": "才",
    "正财": "财",
}

positionEnDict = {
    "年干": "niangan",
    "年支": "nianzhi",
    "月干": "yuegan",
    "月支": "yuezhi",
    "日干": "rigan",
    "日支": "rizhi",
    "时干": "shigan",
    "时支": "shizhi",
    "大运干": "dayungan",
    "大运支": "dayunzhi",
    "流年干": "liuniangan",
    "流年支": "liunianzhi",
    "流月干": "liuyuegan",
    "流月支": "liuyuezhi",
    "流日干": "liurigan",
    "流日支": "liurizhi",
}

dizhi_canggan_dict = {
    "子": ["癸"],
    "丑": ["己", "癸", "辛"],
    "寅": ["甲", "丙", "戊"],
    "卯": ["乙"],
    "辰": ["戊", "乙", "癸"],
    "巳": ["丙", "庚", "戊"],
    "午": ["丁", "己"],
    "未": ["己", "丁", "乙"],
    "申": ["庚", "壬", "戊"],
    "酉": ["辛"],
    "戌": ["戊", "辛", "丁"],
    "亥": ["壬", "甲"],
}

canggan_dic = {
    0: [9],
    1: [5, 9, 7],
    2: [0, 2, 4],
    3: [1],
    4: [4, 1, 9],
    5: [2, 6, 4],
    6: [3, 5],
    7: [5, 3, 1],
    8: [6, 8, 4],
    9: [7],
    10: [4, 7, 3],
    11: [8, 0],
}

pos_dict = {
    (0, 0): "niangan",
    (0, 1): "yuegan",
    (0, 2): "rigan",
    (0, 3): "shigan",
    (1, 0): "nianzhi",
    (1, 1): "yuezhi",
    (1, 2): "rizhi",
    (1, 3): "shizhi",
}

pos_translations = {
    "niangan": "年干",
    "yuegan": "月干",
    "rigan": "日干",
    "shigan": "时干",
    "nianzhi": "年支",
    "yuezhi": "月支",
    "rizhi": "日支",
    "shizhi": "时支",
    "dayungan": "大运干",
    "dayunzhi": "大运支",
    "liuniangan": "流年干",
    "liunianzhi": "流年支",
    "liuyuegan": "流月干",
    "liuyuezhi": "流月支",
    "liurigan": "流日干",
    "liurizhi": "流日支",
}

relation_dict = {
    "丁": {
        "丁": ["相同五行"],
        "丑": ["同性生"],
        "丙": ["异性五行"],
        "乙": ["同性被生"],
        "亥": ["异性被克"],
        "午": ["相同五行"],
        "卯": ["同性被生"],
        "壬": ["异性被克", "合"],
        "子": ["同性被克"],
        "寅": ["异性被生"],
        "己": ["同性生"],
        "巳": ["异性五行"],
        "庚": ["异性克"],
        "戊": ["异性生"],
        "戌": ["异性生"],
        "未": ["同性生"],
        "甲": ["异性被生"],
        "申": ["异性克"],
        "癸": ["同性被克"],
        "辛": ["同性克"],
        "辰": ["异性生"],
        "酉": ["同性克"],
    },
    "丑": {
        "丁": ["同性被生"],
        "丑": ["相同五行"],
        "丙": ["异性被生"],
        "乙": ["同性被克"],
        "亥": ["异性克", "半会"],
        "午": ["害", "同性被生"],
        "卯": ["同性被克"],
        "壬": ["异性克"],
        "子": ["六合", "同性克", "半会"],
        "寅": ["异性被克", "暗合"],
        "己": ["相同五行"],
        "巳": ["异性被生", "生墓半合","半合"],
        "庚": ["异性生"],
        "戊": ["异性五行"],
        "戌": ["恃势之刑", "异性五行", "相刑", "三刑"],
        "未": ["相同五行", "六冲", "冲"],
        "甲": ["异性被克"],
        "申": ["异性生"],
        "癸": ["同性克"],
        "辛": ["同性生"],
        "辰": ["异性五行", "破"],
        "酉": ["同性生", "墓地半合","半合"],
    },
    "丙": {
        "丁": ["异性五行"],
        "丑": ["异性生"],
        "丙": ["相同五行"],
        "乙": ["异性被生"],
        "亥": ["同性被克"],
        "午": ["异性五行"],
        "卯": ["异性被生"],
        "壬": ["冲", "同性被克"],
        "子": ["异性被克"],
        "寅": ["同性被生"],
        "己": ["异性生"],
        "巳": ["相同五行"],
        "庚": ["同性克"],
        "戊": ["同性生"],
        "戌": ["同性生"],
        "未": ["异性生"],
        "甲": ["同性被生"],
        "申": ["同性克"],
        "癸": ["异性被克"],
        "辛": ["异性克", "合"],
        "辰": ["同性生"],
        "酉": ["异性克"],
    },
    "乙": {
        "丁": ["同性生"],
        "丑": ["同性克"],
        "丙": ["异性生"],
        "乙": ["相同五行"],
        "亥": ["异性被生"],
        "午": ["同性生"],
        "卯": ["相同五行"],
        "壬": ["异性被生"],
        "子": ["同性被生"],
        "寅": ["异性五行"],
        "己": ["同性克"],
        "巳": ["异性生", "暗合"],
        "庚": ["异性被克", "合"],
        "戊": ["异性克"],
        "戌": ["异性克"],
        "未": ["同性克"],
        "甲": ["异性五行"],
        "申": ["异性被克"],
        "癸": ["同性被生"],
        "辛": ["冲", "同性被克"],
        "辰": ["异性克"],
        "酉": ["同性被克"],
    },
    "亥": {
        "丁": ["异性克"],
        "丑": ["异性被克", "半会"],
        "丙": ["同性克"],
        "乙": ["异性生"],
        "亥": ["自刑", "相同五行", "三刑"],
        "午": ["异性克", "暗合"],
        "卯": ["生地半合", "异性生","半合"],
        "壬": ["相同五行"],
        "子": ["异性五行", "半会"],
        "寅": ["同性生", "六合", "破"],
        "己": ["异性被克"],
        "巳": ["六冲", "同性克", "冲"],
        "庚": ["同性被生"],
        "戊": ["同性被克"],
        "戌": ["同性被克"],
        "未": ["异性被克", "生墓半合","半合"],
        "甲": ["同性生"],
        "申": ["害", "同性被生"],
        "癸": ["异性五行"],
        "辛": ["异性被生"],
        "辰": ["同性被克"],
        "酉": ["异性被生"],
    },
    "午": {
        "丁": ["相同五行"],
        "丑": ["害", "同性生"],
        "丙": ["异性五行"],
        "乙": ["同性被生"],
        "亥": ["异性被克", "暗合"],
        "午": ["自刑", "相同五行", "三刑"],
        "卯": ["同性被生", "破"],
        "壬": ["异性被克"],
        "子": ["六冲", "同性被克", "冲"],
        "寅": ["生地半合", "异性被生","半合"],
        "己": ["同性生"],
        "巳": ["异性五行", "半会"],
        "庚": ["异性克"],
        "戊": ["异性生"],
        "戌": ["异性生", "墓地半合","半合"],
        "未": ["同性生", "六合", "半会"],
        "甲": ["异性被生"],
        "申": ["异性克"],
        "癸": ["同性被克"],
        "辛": ["同性克"],
        "辰": ["异性生"],
        "酉": ["同性克"],
    },
    "卯": {
        "丁": ["同性生"],
        "丑": ["同性克"],
        "丙": ["异性生"],
        "乙": ["相同五行"],
        "亥": ["生地半合", "异性被生","半合"],
        "午": ["同性生", "破"],
        "卯": ["相同五行"],
        "壬": ["异性被生"],
        "子": ["无礼之刑", "相刑", "同性被生", "三刑"],
        "寅": ["异性五行", "半会"],
        "己": ["同性克"],
        "巳": ["异性生"],
        "庚": ["异性被克"],
        "戊": ["异性克"],
        "戌": ["异性克", "六合"],
        "未": ["同性克", "墓地半合","半合"],
        "甲": ["异性五行"],
        "申": ["异性被克", "暗合"],
        "癸": ["同性被生"],
        "辛": ["同性被克"],
        "辰": ["异性克", "害", "半会"],
        "酉": ["同性被克", "六冲", "冲"],
    },
    "壬": {
        "丁": ["异性克", "合"],
        "丑": ["异性被克"],
        "丙": ["同性克", "冲"],
        "乙": ["异性生"],
        "亥": ["相同五行"],
        "午": ["异性克"],
        "卯": ["异性生"],
        "壬": ["相同五行"],
        "子": ["异性五行"],
        "寅": ["同性生"],
        "己": ["异性被克"],
        "巳": ["同性克"],
        "庚": ["同性被生"],
        "戊": ["同性被克"],
        "戌": ["同性被克"],
        "未": ["异性被克"],
        "甲": ["同性生"],
        "申": ["同性被生"],
        "癸": ["异性五行"],
        "辛": ["异性被生"],
        "辰": ["同性被克"],
        "酉": ["异性被生"],
    },
    "子": {
        "丁": ["同性克"],
        "丑": ["六合", "同性被克", "半会"],
        "丙": ["异性克"],
        "乙": ["同性生"],
        "亥": ["异性五行", "半会"],
        "午": ["六冲", "同性克", "冲"],
        "卯": ["无礼之刑", "相刑", "同性生", "三刑"],
        "壬": ["异性五行"],
        "子": ["相同五行"],
        "寅": ["异性生"],
        "己": ["同性被克"],
        "巳": ["异性克", "暗合"],
        "庚": ["异性被生"],
        "戊": ["异性被克"],
        "戌": ["异性被克", "暗合"],
        "未": ["害", "同性被克"],
        "甲": ["异性生"],
        "申": ["生地半合", "异性被生","半合"],
        "癸": ["相同五行"],
        "辛": ["同性被生"],
        "辰": ["异性被克", "墓地半合","半合"],
        "酉": ["同性被生", "破"],
    },
    "寅": {
        "丁": ["异性生"],
        "丑": ["异性克", "暗合"],
        "丙": ["同性生"],
        "乙": ["异性五行"],
        "亥": ["六合", "同性被生", "破"],
        "午": ["生地半合", "异性生","半合"],
        "卯": ["异性五行", "半会"],
        "壬": ["同性被生"],
        "子": ["异性被生"],
        "寅": ["相同五行"],
        "己": ["异性克"],
        "巳": ["害", "同性生", "相刑", "无恩之刑", "三刑"],
        "庚": ["同性被克"],
        "戊": ["同性克"],
        "戌": ["半合", "同性克","半合"],
        "未": ["异性克"],
        "甲": ["相同五行"],
        "申": ["六冲", "同性被克", "冲"],
        "癸": ["异性被生"],
        "辛": ["异性被克"],
        "辰": ["同性克", "拱会"],
        "酉": ["异性被克"],
    },
    "己": {
        "丁": ["同性被生"],
        "丑": ["相同五行"],
        "丙": ["异性被生"],
        "乙": ["同性被克"],
        "亥": ["异性克"],
        "午": ["同性被生"],
        "卯": ["同性被克"],
        "壬": ["异性克"],
        "子": ["同性克"],
        "寅": ["异性被克"],
        "己": ["相同五行"],
        "巳": ["异性被生"],
        "庚": ["异性生"],
        "戊": ["异性五行"],
        "戌": ["异性五行"],
        "未": ["相同五行"],
        "甲": ["异性被克", "合"],
        "申": ["异性生"],
        "癸": ["同性克"],
        "辛": ["同性生"],
        "辰": ["异性五行"],
        "酉": ["同性生"],
    },
    "巳": {
        "丁": ["异性五行"],
        "丑": ["生墓半合", "异性生","半合"],
        "丙": ["相同五行"],
        "乙": ["异性被生", "暗合"],
        "亥": ["六冲", "同性被克", "冲"],
        "午": ["异性五行", "半会"],
        "卯": ["异性被生"],
        "壬": ["同性被克"],
        "子": ["异性被克", "暗合"],
        "寅": ["害", "同性被生"],
        "己": ["异性生"],
        "巳": ["相同五行"],
        "庚": ["同性克"],
        "戊": ["同性生"],
        "戌": ["同性生"],
        "未": ["异性生", "拱会"],
        "甲": ["同性被生"],
        "申": ["同性克", "无恩之刑", "破", "相刑", "六合", "三刑"],
        "癸": ["异性被克"],
        "辛": ["异性克"],
        "辰": ["同性生"],
        "酉": ["异性克", "生地半合","半合"],
    },
    "庚": {
        "丁": ["异性被克"],
        "丑": ["异性被生"],
        "丙": ["同性被克"],
        "乙": ["异性克", "合"],
        "亥": ["同性生"],
        "午": ["异性被克"],
        "卯": ["异性克"],
        "壬": ["同性生"],
        "子": ["异性生"],
        "寅": ["同性克"],
        "己": ["异性被生"],
        "巳": ["同性被克"],
        "庚": ["相同五行"],
        "戊": ["同性被生"],
        "戌": ["同性被生"],
        "未": ["异性被生"],
        "甲": ["同性克", "冲"],
        "申": ["相同五行"],
        "癸": ["异性生"],
        "辛": ["异性五行"],
        "辰": ["同性被生", "暗合"],
        "酉": ["异性五行"],
    },
    "戊": {
        "丁": ["异性被生"],
        "丑": ["异性五行"],
        "丙": ["同性被生"],
        "乙": ["异性被克"],
        "亥": ["同性克"],
        "午": ["异性被生"],
        "卯": ["异性被克"],
        "壬": ["同性克"],
        "子": ["异性克"],
        "寅": ["同性被克"],
        "己": ["异性五行"],
        "巳": ["同性被生"],
        "庚": ["同性生"],
        "戊": ["相同五行"],
        "戌": ["相同五行"],
        "未": ["异性五行"],
        "甲": ["同性被克"],
        "申": ["同性生"],
        "癸": ["异性克", "合"],
        "辛": ["异性生"],
        "辰": ["相同五行", "暗合"],
        "酉": ["异性生"],
    },
    "戌": {
        "丁": ["异性被生"],
        "丑": ["异性五行", "相刑", "三刑"],
        "丙": ["同性被生"],
        "乙": ["异性被克"],
        "亥": ["异性克"],
        "午": ["异性被生", "墓地半合","半合"],
        "卯": ["异性被克", "六合"],
        "壬": ["同性克"],
        "子": ["异性克", "暗合"],
        "寅": ["异性被克", "生墓半合","半合"],
        "己": ["异性五行"],
        "巳": ["异性被生"],
        "庚": ["同性生"],
        "戊": ["相同五行"],
        "戌": ["相同五行"],
        "未": ["恃势之刑", "异性五行", "破", "三刑"],
        "甲": ["同性被克"],
        "申": ["异性生", "拱会"],
        "癸": ["异性克"],
        "辛": ["异性生"],
        "辰": ["相同五行", "六冲", "冲"],
        "酉": ["害", "异性生", "半会"],
    },
    "未": {
        "丁": ["同性被生"],
        "丑": ["相同五行", "六冲", "冲"],
        "丙": ["异性被生"],
        "乙": ["同性被克"],
        "亥": ["异性克", "生墓半合","半合"],
        "午": ["异性被生", "半会","六合"],
        "卯": ["异性被克", "墓地半合","半合"],
        "壬": ["异性克"],
        "子": ["异性克", "害"],
        "寅": ["异性被克"],
        "己": ["相同五行"],
        "巳": ["异性被生", "拱会"],
        "庚": ["异性生"],
        "戊": ["异性五行"],
        "戌": ["异性五行"],
        "未": ["相同五行"],
        "甲": ["异性被克"],
        "申": ["异性生"],
        "癸": ["同性克"],
        "辛": ["同性生"],
        "辰": ["异性五行"],
        "酉": ["异性生"],
    },
    "甲": {
        "丁": ["异性生"],
        "丑": ["异性克"],
        "丙": ["同性生"],
        "乙": ["异性五行"],
        "亥": ["同性被生"],
        "午": ["异性生"],
        "卯": ["异性五行"],
        "壬": ["同性被生"],
        "子": ["异性被生"],
        "寅": ["相同五行"],
        "己": ["异性克", "合"],
        "巳": ["同性生"],
        "庚": ["冲", "同性被克"],
        "戊": ["同性克"],
        "戌": ["同性克"],
        "未": ["异性克"],
        "甲": ["相同五行"],
        "申": ["同性被克"],
        "癸": ["异性被生"],
        "辛": ["异性被克"],
        "辰": ["同性克"],
        "酉": ["异性被克"],
    },
    "申": {
        "丁": ["异性被克"],
        "丑": ["异性被生"],
        "丙": ["同性被克"],
        "乙": ["异性克"],
        "亥": ["害", "同性生"],
        "午": ["异性被克"],
        "卯": ["异性克"],
        "壬": ["同性生"],
        "子": ["生地半合", "异性生","半合"],
        "寅": ["同性克", "无恩之刑", "六冲", "相刑", "冲", "三刑"],
        "己": ["异性被生"],
        "巳": ["破", "六合", "同性被克"],
        "庚": ["相同五行"],
        "戊": ["同性被生"],
        "戌": ["同性被生", "拱会"],
        "未": ["异性被生"],
        "甲": ["同性克"],
        "申": ["相同五行"],
        "癸": ["异性生"],
        "辛": ["异性五行"],
        "辰": ["生墓半合", "同性被生","半合"],
        "酉": ["异性五行", "半会"],
    },
    "癸": {
        "丁": ["同性克"],
        "丑": ["同性被克"],
        "丙": ["异性克"],
        "乙": ["同性生"],
        "亥": ["异性五行"],
        "午": ["同性克"],
        "卯": ["同性生"],
        "壬": ["异性五行"],
        "子": ["相同五行"],
        "寅": ["异性生"],
        "己": ["同性被克"],
        "巳": ["异性克"],
        "庚": ["异性被生"],
        "戊": ["异性被克", "合"],
        "戌": ["异性被克"],
        "未": ["同性被克"],
        "甲": ["异性生"],
        "申": ["异性被生"],
        "癸": ["相同五行"],
        "辛": ["同性被生"],
        "辰": ["异性被克"],
        "酉": ["同性被生"],
    },
    "辛": {
        "丁": ["同性被克"],
        "丑": ["同性被生"],
        "丙": ["异性被克", "合"],
        "乙": ["同性克", "冲"],
        "亥": ["异性生"],
        "午": ["同性被克"],
        "卯": ["同性克"],
        "壬": ["异性生"],
        "子": ["同性生"],
        "寅": ["异性克"],
        "己": ["同性被生"],
        "巳": ["异性被克"],
        "庚": ["异性五行"],
        "戊": ["异性被生"],
        "戌": ["异性被生"],
        "未": ["同性被生"],
        "甲": ["异性克"],
        "申": ["异性五行"],
        "癸": ["同性生"],
        "辛": ["相同五行"],
        "辰": ["异性被生"],
        "酉": ["相同五行"],
    },
    "辰": {
        "丁": ["异性被生"],
        "丑": ["异性五行", "破"],
        "丙": ["同性被生"],
        "乙": ["异性被克"],
        "亥": ["同性克"],
        "午": ["异性被生"],
        "卯": ["异性被克", "害", "半会"],
        "壬": ["同性克"],
        "子": ["异性克", "墓地半合","半合"],
        "寅": ["同性被克", "拱会"],
        "己": ["异性五行"],
        "巳": ["同性被生"],
        "庚": ["同性生", "暗合"],
        "戊": ["相同五行", "暗合"],
        "戌": ["相同五行", "六冲", "冲"],
        "未": ["异性五行"],
        "甲": ["同性被克"],
        "申": ["生墓半合", "同性生","半合"],
        "癸": ["异性克"],
        "辛": ["异性生"],
        "辰": ["自刑", "相同五行", "三刑"],
        "酉": ["六合", "异性生"],
    },
    "酉": {
        "丁": ["同性被克"],
        "丑": ["同性被生", "墓地半合","半合"],
        "丙": ["异性被克"],
        "乙": ["同性克"],
        "亥": ["异性生"],
        "午": ["同性被克"],
        "卯": ["同性克", "六冲", "冲"],
        "壬": ["异性生"],
        "子": ["同性生", "破"],
        "寅": ["异性克"],
        "己": ["同性被生"],
        "巳": ["异性被克", "生地半合","半合"],
        "庚": ["异性五行"],
        "戊": ["异性被生"],
        "戌": ["异性被生", "害", "半会"],
        "未": ["同性被生"],
        "甲": ["异性克"],
        "申": ["异性五行", "半会"],
        "癸": ["同性生"],
        "辛": ["相同五行"],
        "辰": ["异性被生", "六合"],
        "酉": ["自刑", "相同五行", "三刑"],
    },
}


shengke_dict = {
    "丁": {
        "丁": "相同五行",
        "丑": "同性生",
        "丙": "异性五行",
        "乙": "同性被生",
        "亥": "异性被克",
        "午": "相同五行",
        "卯": "同性被生",
        "壬": "异性被克",
        "子": "同性被克",
        "寅": "异性被生",
        "己": "同性生",
        "巳": "异性五行",
        "庚": "异性克",
        "戊": "异性生",
        "戌": "异性生",
        "未": "同性生",
        "甲": "异性被生",
        "申": "异性克",
        "癸": "同性被克",
        "辛": "同性克",
        "辰": "异性生",
        "酉": "同性克",
    },
    "丑": {
        "丁": "同性被生",
        "丑": "相同五行",
        "丙": "异性被生",
        "乙": "同性被克",
        "亥": "异性克",
        "午": "同性被生",
        "卯": "同性被克",
        "壬": "异性克",
        "子": "同性克",
        "寅": "异性被克",
        "己": "相同五行",
        "巳": "异性被生",
        "庚": "异性生",
        "戊": "异性五行",
        "戌": "异性五行",
        "未": "相同五行",
        "甲": "异性被克",
        "申": "异性生",
        "癸": "同性克",
        "辛": "同性生",
        "辰": "异性五行",
        "酉": "同性生",
    },
    "丙": {
        "丁": "异性五行",
        "丑": "异性生",
        "丙": "相同五行",
        "乙": "异性被生",
        "亥": "同性被克",
        "午": "异性五行",
        "卯": "异性被生",
        "壬": "同性被克",
        "子": "异性被克",
        "寅": "同性被生",
        "己": "异性生",
        "巳": "相同五行",
        "庚": "同性克",
        "戊": "同性生",
        "戌": "同性生",
        "未": "异性生",
        "甲": "同性被生",
        "申": "同性克",
        "癸": "异性被克",
        "辛": "异性克",
        "辰": "同性生",
        "酉": "异性克",
    },
    "乙": {
        "丁": "同性生",
        "丑": "同性克",
        "丙": "异性生",
        "乙": "相同五行",
        "亥": "异性被生",
        "午": "同性生",
        "卯": "相同五行",
        "壬": "异性被生",
        "子": "同性被生",
        "寅": "异性五行",
        "己": "同性克",
        "巳": "异性生",
        "庚": "异性被克",
        "戊": "异性克",
        "戌": "异性克",
        "未": "同性克",
        "甲": "异性五行",
        "申": "异性被克",
        "癸": "同性被生",
        "辛": "同性被克",
        "辰": "异性克",
        "酉": "同性被克",
    },
    "亥": {
        "丁": "异性克",
        "丑": "异性被克",
        "丙": "同性克",
        "乙": "异性生",
        "亥": "相同五行",
        "午": "异性克",
        "卯": "异性生",
        "壬": "相同五行",
        "子": "异性五行",
        "寅": "同性生",
        "己": "异性被克",
        "巳": "同性克",
        "庚": "同性被生",
        "戊": "同性被克",
        "戌": "同性被克",
        "未": "异性被克",
        "甲": "同性生",
        "申": "同性被生",
        "癸": "异性五行",
        "辛": "异性被生",
        "辰": "同性被克",
        "酉": "异性被生",
    },
    "午": {
        "丁": "相同五行",
        "丑": "同性生",
        "丙": "异性五行",
        "乙": "同性被生",
        "亥": "异性被克",
        "午": "相同五行",
        "卯": "同性被生",
        "壬": "异性被克",
        "子": "同性被克",
        "寅": "异性被生",
        "己": "同性生",
        "巳": "异性五行",
        "庚": "异性克",
        "戊": "异性生",
        "戌": "异性生",
        "未": "同性生",
        "甲": "异性被生",
        "申": "异性克",
        "癸": "同性被克",
        "辛": "同性克",
        "辰": "异性生",
        "酉": "同性克",
    },
    "卯": {
        "丁": "同性生",
        "丑": "同性克",
        "丙": "异性生",
        "乙": "相同五行",
        "亥": "异性被生",
        "午": "同性生",
        "卯": "相同五行",
        "壬": "异性被生",
        "子": "同性被生",
        "寅": "异性五行",
        "己": "同性克",
        "巳": "异性生",
        "庚": "异性被克",
        "戊": "异性克",
        "戌": "异性克",
        "未": "同性克",
        "甲": "异性五行",
        "申": "异性被克",
        "癸": "同性被生",
        "辛": "同性被克",
        "辰": "异性克",
        "酉": "同性被克",
    },
    "壬": {
        "丁": "异性克",
        "丑": "异性被克",
        "丙": "同性克",
        "乙": "异性生",
        "亥": "相同五行",
        "午": "异性克",
        "卯": "异性生",
        "壬": "相同五行",
        "子": "异性五行",
        "寅": "同性生",
        "己": "异性被克",
        "巳": "同性克",
        "庚": "同性被生",
        "戊": "同性被克",
        "戌": "同性被克",
        "未": "异性被克",
        "甲": "同性生",
        "申": "同性被生",
        "癸": "异性五行",
        "辛": "异性被生",
        "辰": "同性被克",
        "酉": "异性被生",
    },
    "子": {
        "丁": "同性克",
        "丑": "同性被克",
        "丙": "异性克",
        "乙": "同性生",
        "亥": "异性五行",
        "午": "同性克",
        "卯": "同性生",
        "壬": "异性五行",
        "子": "相同五行",
        "寅": "异性生",
        "己": "同性被克",
        "巳": "异性克",
        "庚": "异性被生",
        "戊": "异性被克",
        "戌": "异性被克",
        "未": "同性被克",
        "甲": "异性生",
        "申": "异性被生",
        "癸": "相同五行",
        "辛": "同性被生",
        "辰": "异性被克",
        "酉": "同性被生",
    },
    "寅": {
        "丁": "异性生",
        "丑": "异性克",
        "丙": "同性生",
        "乙": "异性五行",
        "亥": "同性被生",
        "午": "异性生",
        "卯": "异性五行",
        "壬": "同性被生",
        "子": "异性被生",
        "寅": "相同五行",
        "己": "异性克",
        "巳": "同性生",
        "庚": "同性被克",
        "戊": "同性克",
        "戌": "同性克",
        "未": "异性克",
        "甲": "相同五行",
        "申": "同性被克",
        "癸": "异性被生",
        "辛": "异性被克",
        "辰": "同性克",
        "酉": "异性被克",
    },
    "己": {
        "丁": "同性被生",
        "丑": "相同五行",
        "丙": "异性被生",
        "乙": "同性被克",
        "亥": "异性克",
        "午": "同性被生",
        "卯": "同性被克",
        "壬": "异性克",
        "子": "同性克",
        "寅": "异性被克",
        "己": "相同五行",
        "巳": "异性被生",
        "庚": "异性生",
        "戊": "异性五行",
        "戌": "异性五行",
        "未": "相同五行",
        "甲": "异性被克",
        "申": "异性生",
        "癸": "同性克",
        "辛": "同性生",
        "辰": "异性五行",
        "酉": "同性生",
    },
    "巳": {
        "丁": "异性五行",
        "丑": "异性生",
        "丙": "相同五行",
        "乙": "异性被生",
        "亥": "同性被克",
        "午": "异性五行",
        "卯": "异性被生",
        "壬": "同性被克",
        "子": "异性被克",
        "寅": "同性被生",
        "己": "异性生",
        "巳": "相同五行",
        "庚": "同性克",
        "戊": "同性生",
        "戌": "同性生",
        "未": "异性生",
        "甲": "同性被生",
        "申": "同性克",
        "癸": "异性被克",
        "辛": "异性克",
        "辰": "同性生",
        "酉": "异性克",
    },
    "庚": {
        "丁": "异性被克",
        "丑": "异性被生",
        "丙": "同性被克",
        "乙": "异性克",
        "亥": "同性生",
        "午": "异性被克",
        "卯": "异性克",
        "壬": "同性生",
        "子": "异性生",
        "寅": "同性克",
        "己": "异性被生",
        "巳": "同性被克",
        "庚": "相同五行",
        "戊": "同性被生",
        "戌": "同性被生",
        "未": "异性被生",
        "甲": "同性克",
        "申": "相同五行",
        "癸": "异性生",
        "辛": "异性五行",
        "辰": "同性被生",
        "酉": "异性五行",
    },
    "戊": {
        "丁": "异性被生",
        "丑": "异性五行",
        "丙": "同性被生",
        "乙": "异性被克",
        "亥": "同性克",
        "午": "异性被生",
        "卯": "异性被克",
        "壬": "同性克",
        "子": "异性克",
        "寅": "同性被克",
        "己": "异性五行",
        "巳": "同性被生",
        "庚": "同性生",
        "戊": "相同五行",
        "戌": "相同五行",
        "未": "异性五行",
        "甲": "同性被克",
        "申": "同性生",
        "癸": "异性克",
        "辛": "异性生",
        "辰": "相同五行",
        "酉": "异性生",
    },
    "戌": {
        "丁": "异性被生",
        "丑": "异性五行",
        "丙": "同性被生",
        "乙": "异性被克",
        "亥": "异性克",
        "午": "异性被生",
        "卯": "异性被克",
        "壬": "同性克",
        "子": "异性克",
        "寅": "异性被克",
        "己": "异性五行",
        "巳": "异性被生",
        "庚": "同性生",
        "戊": "相同五行",
        "戌": "相同五行",
        "未": "异性五行",
        "甲": "同性被克",
        "申": "异性生",
        "癸": "异性克",
        "辛": "异性生",
        "辰": "相同五行",
        "酉": "异性生",
    },
    "未": {
        "丁": "同性被生",
        "丑": "相同五行",
        "丙": "异性被生",
        "乙": "同性被克",
        "亥": "异性克",
        "午": "异性被生",
        "卯": "异性被克",
        "壬": "异性克",
        "子": "异性克",
        "寅": "异性被克",
        "己": "相同五行",
        "巳": "异性被生",
        "庚": "异性生",
        "戊": "异性五行",
        "戌": "异性五行",
        "未": "相同五行",
        "甲": "异性被克",
        "申": "异性生",
        "癸": "同性克",
        "辛": "同性生",
        "辰": "异性五行",
        "酉": "异性生",
    },
    "甲": {
        "丁": "异性生",
        "丑": "异性克",
        "丙": "同性生",
        "乙": "异性五行",
        "亥": "同性被生",
        "午": "异性生",
        "卯": "异性五行",
        "壬": "同性被生",
        "子": "异性被生",
        "寅": "相同五行",
        "己": "异性克",
        "巳": "同性生",
        "庚": "同性被克",
        "戊": "同性克",
        "戌": "同性克",
        "未": "异性克",
        "甲": "相同五行",
        "申": "同性被克",
        "癸": "异性被生",
        "辛": "异性被克",
        "辰": "同性克",
        "酉": "异性被克",
    },
    "申": {
        "丁": "异性被克",
        "丑": "异性被生",
        "丙": "同性被克",
        "乙": "异性克",
        "亥": "同性生",
        "午": "异性被克",
        "卯": "异性克",
        "壬": "同性生",
        "子": "异性生",
        "寅": "同性克",
        "己": "异性被生",
        "巳": "同性被克",
        "庚": "相同五行",
        "戊": "同性被生",
        "戌": "同性被生",
        "未": "异性被生",
        "甲": "同性克",
        "申": "相同五行",
        "癸": "异性生",
        "辛": "异性五行",
        "辰": "同性被生",
        "酉": "异性五行",
    },
    "癸": {
        "丁": "同性克",
        "丑": "同性被克",
        "丙": "异性克",
        "乙": "同性生",
        "亥": "异性五行",
        "午": "同性克",
        "卯": "同性生",
        "壬": "异性五行",
        "子": "相同五行",
        "寅": "异性生",
        "己": "同性被克",
        "巳": "异性克",
        "庚": "异性被生",
        "戊": "异性被克",
        "戌": "异性被克",
        "未": "同性被克",
        "甲": "异性生",
        "申": "异性被生",
        "癸": "相同五行",
        "辛": "同性被生",
        "辰": "异性被克",
        "酉": "同性被生",
    },
    "辛": {
        "丁": "同性被克",
        "丑": "同性被生",
        "丙": "异性被克",
        "乙": "同性克",
        "亥": "异性生",
        "午": "同性被克",
        "卯": "同性克",
        "壬": "异性生",
        "子": "同性生",
        "寅": "异性克",
        "己": "同性被生",
        "巳": "异性被克",
        "庚": "异性五行",
        "戊": "异性被生",
        "戌": "异性被生",
        "未": "同性被生",
        "甲": "异性克",
        "申": "异性五行",
        "癸": "同性生",
        "辛": "相同五行",
        "辰": "异性被生",
        "酉": "相同五行",
    },
    "辰": {
        "丁": "异性被生",
        "丑": "异性五行",
        "丙": "同性被生",
        "乙": "异性被克",
        "亥": "同性克",
        "午": "异性被生",
        "卯": "异性被克",
        "壬": "同性克",
        "子": "异性克",
        "寅": "同性被克",
        "己": "异性五行",
        "巳": "同性被生",
        "庚": "同性生",
        "戊": "相同五行",
        "戌": "相同五行",
        "未": "异性五行",
        "甲": "同性被克",
        "申": "同性生",
        "癸": "异性克",
        "辛": "异性生",
        "辰": "相同五行",
        "酉": "异性生",
    },
    "酉": {
        "丁": "同性被克",
        "丑": "同性被生",
        "丙": "异性被克",
        "乙": "同性克",
        "亥": "异性生",
        "午": "同性被克",
        "卯": "同性克",
        "壬": "异性生",
        "子": "同性生",
        "寅": "异性克",
        "己": "同性被生",
        "巳": "异性被克",
        "庚": "异性五行",
        "戊": "异性被生",
        "戌": "异性被生",
        "未": "同性被生",
        "甲": "异性克",
        "申": "异性五行",
        "癸": "同性生",
        "辛": "相同五行",
        "辰": "异性被生",
        "酉": "相同五行",
    },
}

shengke_opposit_dict = {
    "同性被生": "同性生",
    "异性被生": "异性生",
    "同性被克": "同性克",
    "异性被克": "异性克",
    "相同五行": "相同五行",
    "异性五行": "异性五行",
    "同性生": "同性被生",
    "异性生": "异性被生",
    "同性克": "同性被克",
    "异性克": "异性被克",
}


gan_relations = {
    "甲": {"庚": ["冲"], "己": ["合"]},
    "乙": {"辛": ["冲"], "庚": ["合"]},
    "丙": {"壬": ["冲"], "辛": ["合"]},
    "丁": {"壬": ["合"]},
    "戊": {"癸": ["合"]},
    "己": {"甲": ["合"]},
    "庚": {"甲": ["冲"], "乙": ["合"]},
    "辛": {"乙": ["冲"], "丙": ["合"]},
    "壬": {"丙": ["冲"], "丁": ["合"]},
    "癸": {"戊": ["合"]},
}

zhi_relations = {
    "子": {
        "丑": ["六合"],
        "午": ["六冲"],
        "未": ["害"],
        "卯": ["无礼之刑", "相刑"],
        "酉": ["破"],
        "申": ["生地半合"],
        "辰": ["墓地半合"],
    },
    "丑": {
        "子": ["六合"],
        "未": ["六冲"],
        "午": ["害"],
        "戌": ["恃势之刑", "相刑"],
        "辰": ["破"],
        "酉": ["墓地半合"],
        "巳": ["生墓半合"],
    },
    "酉": {
        "戌": ["害"],
        "酉": ["自刑"],
        "子": ["破"],
        "辰": ["六合"],
        "巳": ["生地半合"],
        "丑": ["墓地半合"],
        "卯": ["六冲"],
    },
    "未": {
        "丑": ["六冲", "恃势之刑", "相刑"],
        "戌": ["破"],
        "午": ["未"],
        "卯": ["墓地半合"],
    },
    "午": {
        "子": ["六冲"],
        "丑": ["害"],
        "午": ["自刑"],
        "卯": ["破"],
        "未": ["六合"],
        "寅": ["生地半合"],
        "戌": ["墓地半合"],
    },
    "寅": {
        "申": ["六冲"],
        "巳": ["害", "无恩之刑", "相刑"],
        "亥": ["破", "六合"],
        "午": ["生地半合"],
        "戌": ["半合"],
    },
    "卯": {
        "辰": ["害"],
        "子": ["无礼之刑", "相刑"],
        "午": ["破"],
        "戌": ["六合"],
        "亥": ["生地半合"],
        "未": ["墓地半合"],
        "酉": ["六冲"],
    },
    "申": {
        "寅": ["六冲", "无恩之刑", "相刑"],
        "亥": ["害"],
        "巳": ["破", "六合"],
        "子": ["生地半合"],
        "辰": ["生墓半合"],
    },
    "辰": {
        "戌": ["六冲"],
        "卯": ["害"],
        "辰": ["自刑"],
        "丑": ["破"],
        "酉": ["六合"],
        "子": ["墓地半合"],
        "申": ["生墓半合"],
    },
    "戌": {
        "辰": ["六冲"],
        "酉": ["害"],
        "未": ["恃势之刑", "破"],
        "卯": ["六合"],
        "午": ["墓地半合"],
        "寅": ["生墓半合"],
    },
    "巳": {
        "酉": ["生地半合"],
        "亥": ["六冲"],
        "寅": ["害"],
        "申": ["无恩之刑", "破", "六合", "相刑"],
        "丑": ["生墓半合"],
    },
    "亥": {
        "巳": ["六冲"],
        "申": ["害"],
        "亥": ["自刑"],
        "寅": ["破", "六合"],
        "卯": ["生地半合"],
        "未": ["生墓半合"],
    },
    "未": {"子": ["害"], "亥": ["生墓半合"]},
}

Wuxing_tu_zhi = ["丑", "未", "辰", "戌"]
Zhongshen_zhi = ["子", "午", "卯", "酉"]
Gan = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]
Zhi = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]
ShX = ["鼠", "牛", "虎", "兔", "龙", "蛇", "马", "羊", "猴", "鸡", "狗", "猪"]
numCn = ["零", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十"]
jqmc = [
    "冬至",
    "小寒",
    "大寒",
    "立春",
    "雨水",
    "惊蛰",
    "春分",
    "清明",
    "谷雨",
    "立夏",
    "小满",
    "芒种",
    "夏至",
    "小暑",
    "大暑",
    "立秋",
    "处暑",
    "白露",
    "秋分",
    "寒露",
    "霜降",
    "立冬",
    "小雪",
    "大雪",
]
ymc = ["十一", "十二", "正", "二", "三", "四", "五", "六", "七", "八", "九", "十"]
rmc = [
    "初一",
    "初二",
    "初三",
    "初四",
    "初五",
    "初六",
    "初七",
    "初八",
    "初九",
    "初十",
    "十一",
    "十二",
    "十三",
    "十四",
    "十五",
    "十六",
    "十七",
    "十八",
    "十九",
    "二十",
    "廿一",
    "廿二",
    "廿三",
    "廿四",
    "廿五",
    "廿六",
    "廿七",
    "廿八",
    "廿九",
    "三十",
    "卅一",
]
XiZ = [
    "摩羯",
    "水瓶",
    "双鱼",
    "白羊",
    "金牛",
    "双子",
    "巨蟹",
    "狮子",
    "处女",
    "天秤",
    "天蝎",
    "射手",
]
WeekCn = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]


wuxing_dict = {
    # 天干
    "甲": "木", "乙": "木",
    "丙": "火", "丁": "火",
    "戊": "土", "己": "土",
    "庚": "金", "辛": "金",
    "壬": "水", "癸": "水",
    
    # 地支
    "子": "水", "亥": "水",
    "寅": "木", "卯": "木",
    "巳": "火", "午": "火",
    "申": "金", "酉": "金",
    "辰": "土", "戌": "土", "丑": "土", "未": "土"
}

yinyang_dict = {
    "子": "阳中阴",
    "丑": "阴",
    "寅": "阳",
    "卯": "阴",
    "辰": "阳中少阴",
    "巳": "阴中阳",
    "午": "阳中阴",
    "未": "阴",
    "申": "阳",
    "酉": "阴",
    "戌": "阳中少阴",
    "亥": "阴",
    "甲": "阳",
    "乙": "阴",
    "丙": "阳",
    "丁": "阴",
    "戊": "阳",
    "己": "阴",
    "庚": "阳",
    "辛": "阴",
    "壬": "阳",
    "癸": "阴",
}
tiangan_relations = {
    "甲": {
        "甲": "比肩",
        "乙": "劫财",
        "丙": "食神",
        "丁": "伤官",
        "戊": "偏财",
        "己": "正财",
        "庚": "七杀",
        "辛": "正官",
        "壬": "偏印",
        "癸": "正印",
        "子": "沐浴",
        "丑": "冠带",
        "寅": "临官",
        "卯": "帝旺",
        "辰": "衰",
        "巳": "病",
        "午": "死",
        "未": "墓",
        "申": "绝",
        "酉": "胎",
        "戌": "养",
        "亥": "长生",
        "库": "未_",
        "本": "木",
        "克": "土",
        "被克": "金",
        "生我": "水",
        "生": "火",
        "合": "己",
        "冲": "庚",
    },
    "乙": {
        "甲": "劫财",
        "乙": "比肩",
        "丙": "伤官",
        "丁": "食神",
        "戊": "正财",
        "己": "偏财",
        "庚": "正官",
        "辛": "七杀",
        "壬": "正印",
        "癸": "偏印",
        "子": "病",
        "丑": "衰",
        "寅": "帝旺",
        "卯": "临官",
        "辰": "冠带",
        "巳": "沐浴",
        "午": "长生",
        "未": "养",
        "申": "胎",
        "酉": "绝",
        "戌": "墓",
        "亥": "死",
        "库": "未",
        "本": "木",
        "克": "土",
        "被克": "金",
        "生我": "水",
        "生": "火",
        "合": "庚",
        "冲": "辛",
    },
    "丙": {
        "丙": "比肩",
        "丁": "劫财",
        "戊": "食神",
        "己": "伤官",
        "庚": "偏财",
        "辛": "正财",
        "壬": "七杀",
        "癸": "正官",
        "甲": "偏印",
        "乙": "正印",
        "子": "胎",
        "丑": "养",
        "寅": "长生",
        "卯": "沐浴",
        "辰": "冠带",
        "巳": "临官",
        "午": "帝旺",
        "未": "衰",
        "申": "病",
        "酉": "死",
        "戌": "墓",
        "亥": "绝",
        "库": "戌_",
        "本": "火",
        "克": "金",
        "被克": "水",
        "生我": "木",
        "生": "土",
        "合": "辛",
        "冲": "壬",
    },
    "丁": {
        "丙": "劫财",
        "丁": "比肩",
        "戊": "伤官",
        "己": "食神",
        "庚": "正财",
        "辛": "偏财",
        "壬": "正官",
        "癸": "七杀",
        "甲": "正印",
        "乙": "偏印",
        "子": "绝",
        "丑": "墓",
        "寅": "死",
        "卯": "病",
        "辰": "衰",
        "巳": "帝旺",
        "午": "临官",
        "未": "冠带",
        "申": "沐浴",
        "酉": "长生",
        "戌": "养",
        "亥": "胎",
        "库": "戌_",
        "本": "火",
        "克": "金",
        "被克": "水",
        "生我": "木",
        "生": "土",
        "合": "壬",
        "冲": "癸",
    },
    "戊": {
        "戊": "比肩",
        "己": "劫财",
        "庚": "食神",
        "辛": "伤官",
        "壬": "偏财",
        "癸": "正财",
        "甲": "七杀",
        "乙": "正官",
        "丙": "偏印",
        "丁": "正印",
        "子": "胎",
        "丑": "养",
        "寅": "长生",
        "卯": "沐浴",
        "辰": "冠带",
        "巳": "临官",
        "午": "帝旺",
        "未": "衰",
        "申": "病",
        "酉": "死",
        "戌": "墓",
        "亥": "绝",
        "库": "辰_",
        "本": "土",
        "克": "水",
        "被克": "木",
        "生我": "火",
        "生": "金",
        "合": "癸",
        "冲": "",
    },
    "己": {
        "戊": "劫财",
        "己": "比肩",
        "庚": "伤官",
        "辛": "食神",
        "壬": "正财",
        "癸": "偏财",
        "甲": "正官",
        "乙": "七杀",
        "丙": "正印",
        "丁": "偏印",
        "子": "绝",
        "丑": "墓",
        "寅": "死",
        "卯": "病",
        "辰": "衰",
        "巳": "帝旺",
        "午": "临官",
        "未": "冠带",
        "申": "沐浴",
        "酉": "长生",
        "戌": "养",
        "亥": "胎",
        "库": "辰_",
        "本": "土",
        "克": "水",
        "被克": "木",
        "生我": "火",
        "生": "金",
        "合": "甲",
        "冲": "",
    },
    "庚": {
        "庚": "比肩",
        "辛": "劫财",
        "壬": "食神",
        "癸": "伤官",
        "甲": "偏财",
        "乙": "正财",
        "丙": "七杀",
        "丁": "正官",
        "戊": "偏印",
        "己": "正印",
        "子": "死",
        "丑": "墓",
        "寅": "绝",
        "卯": "胎",
        "辰": "养",
        "巳": "长生",
        "午": "沐浴",
        "未": "冠带",
        "申": "临官",
        "酉": "帝旺",
        "戌": "衰",
        "亥": "病",
        "库": "丑_",
        "本": "金",
        "克": "木",
        "被克": "火",
        "生我": "土",
        "生": "水",
        "合": "乙",
        "冲": "甲",
    },
    "辛": {
        "庚": "劫财",
        "辛": "比肩",
        "壬": "伤官",
        "癸": "食神",
        "甲": "正财",
        "乙": "偏财",
        "丙": "正官",
        "丁": "七杀",
        "戊": "正印",
        "己": "偏印",
        "子": "长生",
        "丑": "养",
        "寅": "胎",
        "卯": "绝",
        "辰": "墓",
        "巳": "死",
        "午": "病",
        "未": "衰",
        "申": "帝旺",
        "酉": "临官",
        "戌": "冠带",
        "亥": "沐浴",
        "库": "丑_",
        "本": "金",
        "克": "木",
        "被克": "火",
        "生我": "土",
        "生": "水",
        "合": "丙",
        "冲": "乙",
    },
    "壬": {
        "壬": "比肩",
        "癸": "劫财",
        "甲": "食神",
        "乙": "伤官",
        "丙": "偏财",
        "丁": "正财",
        "戊": "七杀",
        "己": "正官",
        "庚": "偏印",
        "辛": "正印",
        "子": "帝旺",
        "丑": "衰",
        "寅": "病",
        "卯": "死",
        "辰": "墓",
        "巳": "绝",
        "午": "胎",
        "未": "养",
        "申": "长生",
        "酉": "沐浴",
        "戌": "冠带",
        "亥": "临官",
        "库": "辰_",
        "本": "水",
        "克": "火",
        "被克": "土",
        "生我": "金",
        "生": "木",
        "合": "丁",
        "冲": "丙",
    },
    "癸": {
        "壬": "劫财",
        "癸": "比肩",
        "甲": "伤官",
        "乙": "食神",
        "丙": "正财",
        "丁": "偏财",
        "戊": "正官",
        "己": "七杀",
        "庚": "正印",
        "辛": "偏印",
        "子": "临官",
        "丑": "冠带",
        "寅": "沐浴",
        "卯": "长生",
        "辰": "养",
        "巳": "胎",
        "午": "绝",
        "未": "墓",
        "申": "死",
        "酉": "病",
        "戌": "衰",
        "亥": "帝旺",
        "库": "辰_",
        "本": "水",
        "克": "火",
        "被克": "土",
        "生我": "金",
        "生": "木",
        "合": "戊",
        "冲": "丁",
    },
}

tiangan_dizhi_relations = {
    "甲": {
        "子": "正印",
        "丑": "正财",
        "寅": "比肩",
        "卯": "劫财",
        "辰": "偏财",
        "巳": "食神",
        "午": "伤官",
        "未": "正财",
        "申": "七杀",
        "酉": "正官",
        "戌": "偏财",
    },
    "乙": {
        "子": "偏印",
        "丑": "偏财",
        "寅": "劫财",
        "卯": "比肩",
        "辰": "正财",
        "巳": "伤官",
        "午": "食神",
        "未": "偏财",
        "申": "正官",
        "酉": "七杀",
        "戌": "正财",
    },
    "丙": {"子": "正官", "丑": "伤官", "寅": "偏印", "卯": "正印", "辰": ""},
    "丁": {
        "丙": "劫财",
        "丁": "比肩",
        "戊": "伤官",
        "己": "食神",
        "庚": "正财",
        "辛": "偏财",
        "壬": "正官",
        "癸": "七杀",
        "甲": "正印",
        "乙": "偏印",
        "子": "绝",
        "丑": "墓",
        "寅": "死",
        "卯": "病",
        "辰": "衰",
        "巳": "帝旺",
        "午": "临官",
        "未": "冠带",
        "申": "沐浴",
        "酉": "长生",
        "戌": "养",
        "亥": "胎",
        "库": "戌_",
        "本": "火",
        "克": "金",
        "被克": "水",
        "生我": "木",
        "生": "土",
        "合": "壬",
        "冲": "癸",
    },
    "戊": {
        "戊": "比肩",
        "己": "劫财",
        "庚": "食神",
        "辛": "伤官",
        "壬": "偏财",
        "癸": "正财",
        "甲": "七杀",
        "乙": "正官",
        "丙": "偏印",
        "丁": "正印",
        "子": "胎",
        "丑": "养",
        "寅": "长生",
        "卯": "沐浴",
        "辰": "冠带",
        "巳": "临官",
        "午": "帝旺",
        "未": "衰",
        "申": "病",
        "酉": "死",
        "戌": "墓",
        "亥": "绝",
        "库": "辰_",
        "本": "土",
        "克": "水",
        "被克": "木",
        "生我": "火",
        "生": "金",
        "合": "癸",
        "冲": "",
    },
    "己": {
        "戊": "劫财",
        "己": "比肩",
        "庚": "伤官",
        "辛": "食神",
        "壬": "正财",
        "癸": "偏财",
        "甲": "正官",
        "乙": "七杀",
        "丙": "正印",
        "丁": "偏印",
        "子": "绝",
        "丑": "墓",
        "寅": "死",
        "卯": "病",
        "辰": "衰",
        "巳": "帝旺",
        "午": "临官",
        "未": "冠带",
        "申": "沐浴",
        "酉": "长生",
        "戌": "养",
        "亥": "胎",
        "库": "辰_",
        "本": "土",
        "克": "水",
        "被克": "木",
        "生我": "火",
        "生": "金",
        "合": "甲",
        "冲": "",
    },
    "庚": {
        "庚": "比肩",
        "辛": "劫财",
        "壬": "食神",
        "癸": "伤官",
        "甲": "偏财",
        "乙": "正财",
        "丙": "七杀",
        "丁": "正官",
        "戊": "偏印",
        "己": "正印",
        "子": "死",
        "丑": "墓",
        "寅": "绝",
        "卯": "胎",
        "辰": "养",
        "巳": "长生",
        "午": "沐浴",
        "未": "冠带",
        "申": "临官",
        "酉": "帝旺",
        "戌": "衰",
        "亥": "病",
        "库": "丑_",
        "本": "金",
        "克": "木",
        "被克": "火",
        "生我": "土",
        "生": "水",
        "合": "乙",
        "冲": "甲",
    },
    "辛": {
        "庚": "劫财",
        "辛": "比肩",
        "壬": "伤官",
        "癸": "食神",
        "甲": "正财",
        "乙": "偏财",
        "丙": "正官",
        "丁": "七杀",
        "戊": "正印",
        "己": "偏印",
        "子": "长生",
        "丑": "养",
        "寅": "胎",
        "卯": "绝",
        "辰": "墓",
        "巳": "死",
        "午": "病",
        "未": "衰",
        "申": "帝旺",
        "酉": "临官",
        "戌": "冠带",
        "亥": "沐浴",
        "库": "丑_",
        "本": "金",
        "克": "木",
        "被克": "火",
        "生我": "土",
        "生": "水",
        "合": "丙",
        "冲": "乙",
    },
    "壬": {
        "壬": "比肩",
        "癸": "劫财",
        "甲": "食神",
        "乙": "伤官",
        "丙": "偏财",
        "丁": "正财",
        "戊": "七杀",
        "己": "正官",
        "庚": "偏印",
        "辛": "正印",
        "子": "帝旺",
        "丑": "衰",
        "寅": "病",
        "卯": "死",
        "辰": "墓",
        "巳": "绝",
        "午": "胎",
        "未": "养",
        "申": "长生",
        "酉": "沐浴",
        "戌": "冠带",
        "亥": "临官",
        "库": "辰_",
        "本": "水",
        "克": "火",
        "被克": "土",
        "生我": "金",
        "生": "木",
        "合": "丁",
        "冲": "丙",
    },
    "癸": {
        "壬": "劫财",
        "癸": "比肩",
        "甲": "伤官",
        "乙": "食神",
        "丙": "正财",
        "丁": "偏财",
        "戊": "正官",
        "己": "七杀",
        "庚": "正印",
        "辛": "偏印",
        "子": "临官",
        "丑": "冠带",
        "寅": "沐浴",
        "卯": "长生",
        "辰": "养",
        "巳": "胎",
        "午": "绝",
        "未": "墓",
        "申": "死",
        "酉": "病",
        "戌": "衰",
        "亥": "帝旺",
        "库": "辰_",
        "本": "水",
        "克": "火",
        "被克": "土",
        "生我": "金",
        "生": "木",
        "合": "戊",
        "冲": "丁",
    },
}


def is_leap_year(year):
    if year % 400 == 0:
        return True
    if (year % 4 == 0) and (year % 100 != 0):
        return True


nayin_dict = {
    "甲子": "海中金",
    "乙丑": "海中金",
    "丙寅": "炉中火",
    "丁卯": "炉中火",
    "戊辰": "大林木",
    "己巳": "大林木",
    "庚午": "路傍土",
    "辛未": "路傍土",
    "壬申": "剑锋金",
    "癸酉": "剑锋金",
    "甲戌": "山头火",
    "乙亥": "山头火",
    "丙子": "涧下水",
    "丁丑": "涧下水",
    "戊寅": "城墙土",
    "己卯": "城墙土",
    "庚辰": "白腊金",
    "辛巳": "白腊金",
    "壬午": "杨柳木",
    "癸未": "杨柳木",
    "甲申": "泉中水",
    "乙酉": "泉中水",
    "丙戌": "屋上土",
    "丁亥": "屋上土",
    "戊子": "霹雳火",
    "己丑": "霹雳火",
    "庚寅": "松柏木",
    "辛卯": "松柏木",
    "壬辰": "长流水",
    "癸巳": "长流水",
    "甲午": "沙中金",
    "乙未": "沙中金",
    "丙申": "山下火",
    "丁酉": "山下火",
    "戊戌": "平地木",
    "己亥": "平地木",
    "庚子": "壁上土",
    "辛丑": "壁上土",
    "壬寅": "金箔金",
    "癸卯": "金箔金",
    "甲辰": "佛灯火",
    "乙巳": "佛灯火",
    "丙午": "天河水",
    "丁未": "天河水",
    "戊申": "大驿土",
    "己酉": "大驿土",
    "庚戌": "钗钏金",
    "辛亥": "钗钏金",
    "壬子": "桑柘木",
    "癸丑": "桑柘木",
    "甲寅": "大溪水",
    "乙卯": "大溪水",
    "丙辰": "沙中土",
    "丁巳": "沙中土",
    "戊午": "天上火",
    "己未": "天上火",
    "庚申": "石榴木",
    "辛酉": "石榴木",
    "壬戌": "大海水",
    "癸亥": "大海水",
}
# 围绕日干的神煞
rigan_dizhi_relations = {
    "甲": {
        "未": ["天乙贵人"],
        "丑": ["天乙贵人"],
        "寅": ["禄神", "福星贵人"],
        "子": ["太极贵人", "福星贵人"],
        "午": ["太极贵人", "红艳煞"],
        "戌": ["国印贵人"],
        "巳": ["文昌贵人"],
        "辰": ["金舆"],
        "卯": ["羊刃"],
        "酉": ["流霞"],
    },
    "乙": {
        "子": ["天乙贵人", "太极贵人"],
        "申": ["天乙贵人"],
        "卯": ["禄神", "福星贵人"],
        "午": ["太极贵人", "文昌贵人", "红艳煞"],
        "亥": ["国印贵人"],
        "巳": ["金舆"],
        "寅": ["羊刃"],
        "戌": ["流霞"],
        "丑": ["福星贵人"],
    },
    "丙": {
        "亥": ["天乙贵人"],
        "卯": ["太极贵人"],
        "酉": ["天乙贵人", "太极贵人"],
        "巳": ["禄神", "天厨贵人"],
        "丑": ["国印贵人"],
        "申": ["国印贵人"],
        "未": ["金舆", "流霞"],
        "午": ["羊刃"],
        "寅": ["红艳煞", "福星贵人"],
        "子": ["福星贵人"],
    },
    "丁": {
        "亥": ["天乙贵人", "福星贵人"],
        "卯": ["太极贵人"],
        "酉": ["天乙贵人", "太极贵人", "文昌贵人"],
        "午": ["禄神", "天厨贵人"],
        "寅": ["国印贵人"],
        "申": ["金舆", "流霞"],
        "巳": ["羊刃"],
        "未": ["红艳煞"],
    },
    "戊": {
        "辰": ["太极贵人", "红艳煞"],
        "戌": ["太极贵人"],
        "未": ["天乙贵人", "太极贵人", "金舆"],
        "丑": ["天乙贵人", "太极贵人", "国印贵人"],
        "巳": ["禄神", "流霞"],
        "申": ["文昌贵人", "天厨贵人", "福星贵人"],
        "午": ["羊刃"],
    },
    "己": {
        "辰": ["太极贵人", "红艳煞"],
        "戌": ["太极贵人"],
        "未": ["太极贵人", "福星贵人"],
        "丑": ["太极贵人"],
        "子": ["天乙贵人"],
        "申": ["天乙贵人", "金舆"],
        "午": ["禄神", "流霞"],
        "寅": ["国印贵人"],
        "酉": ["文昌贵人", "天厨贵人"],
        "巳": ["羊刃"],
    },
    "庚": {
        "寅": ["太极贵人"],
        "亥": ["太极贵人", "文昌贵人", "天厨贵人"],
        "未": ["天乙贵人"],
        "丑": ["天乙贵人"],
        "申": ["禄神"],
        "辰": ["国印贵人", "流霞"],
        "戌": ["金舆", "红艳煞"],
        "酉": ["羊刃"],
        "午": ["福星贵人"],
    },
    "辛": {
        "亥": ["太极贵人", "金舆"],
        "午": ["天乙贵人"],
        "寅": ["天乙贵人", "太极贵人"],
        "酉": ["禄神", "红艳煞"],
        "巳": ["国印贵人", "福星贵人"],
        "子": ["文昌贵人", "天厨贵人"],
        "申": ["羊刃"],
        "卯": ["流霞"],
    },
    "壬": {
        "卯": ["天乙贵人"],
        "巳": ["天乙贵人", "太极贵人"],
        "亥": ["禄神", "流霞"],
        "申": ["太极贵人"],
        "未": ["国印贵人"],
        "寅": ["文昌贵人", "天厨贵人"],
        "丑": ["金舆"],
        "子": ["羊刃", "红艳煞"],
        "辰": ["福星贵人"],
    },
    "癸": {
        "卯": ["天乙贵人", "文昌贵人", "天厨贵人", "福星贵人"],
        "巳": ["天乙贵人", "太极贵人"],
        "子": ["禄神"],
        "申": ["太极贵人", "国印贵人", "红艳煞"],
        "寅": ["金舆", "流霞"],
        "亥": ["羊刃"],
        "丑": ["福星贵人"],
    },
}

# 年干 > 地支 神煞
niangan_dizhi_relations = {
    "甲": {
        "未": ["天乙贵人"],
        "丑": ["天乙贵人"],
        "子": ["太极贵人", "福星贵人"],
        "午": ["太极贵人"],
        "寅": ["福星贵人"],
        "戌": ["国印贵人"],
        "巳": ["文昌贵人"],
        "辰": ["金舆"],
    },
    "乙": {
        "子": ["天乙贵人", "太极贵人"],
        "申": ["天乙贵人"],
        "午": ["太极贵人", "文昌贵人"],
        "亥": ["国印贵人"],
        "巳": ["金舆"],
        "卯": ["福星贵人"],
        "丑": ["福星贵人"],
    },
    "丙": {
        "亥": ["天乙贵人"],
        "酉": ["天乙贵人", "太极贵人"],
        "卯": ["太极贵人"],
        "寅": ["福星贵人"],
        "巳": ["天厨贵人"],
        "丑": ["国印贵人"],
        "申": ["文昌贵人"],
        "未": ["金舆"],
        "子": ["福星贵人"],
    },
    "丁": {
        "亥": ["天乙贵人", "福星贵人"],
        "酉": ["天乙贵人", "太极贵人", "文昌贵人"],
        "卯": ["太极贵人"],
        "寅": ["国印贵人"],
        "申": ["金舆"],
        "午": ["天厨贵人"],
    },
    "戊": {
        "辰": ["太极贵人"],
        "戌": ["太极贵人"],
        "未": ["天乙贵人", "太极贵人", "金舆"],
        "丑": ["天乙贵人", "太极贵人", "国印贵人"],
        "申": ["文昌贵人", "天厨贵人", "福星贵人"],
    },
    "己": {
        "辰": ["太极贵人"],
        "戌": ["太极贵人"],
        "未": ["太极贵人", "福星贵人"],
        "丑": ["太极贵人"],
        "子": ["天乙贵人"],
        "申": ["天乙贵人", "金舆"],
        "寅": ["国印贵人"],
        "酉": ["文昌贵人", "天厨贵人"],
    },
    "庚": {
        "未": ["天乙贵人"],
        "丑": ["天乙贵人"],
        "乙": ["太极贵人"],
        "亥": ["太极贵人", "文昌贵人", "天厨贵人"],
        "辰": ["国印贵人"],
        "戌": ["金舆"],
        "午": ["福星贵人"],
    },
    "辛": {
        "午": ["天乙贵人"],
        "寅": ["天乙贵人"],
        "乙": ["太极贵人"],
        "亥": ["太极贵人", "金舆"],
        "巳": ["国印贵人", "福星贵人"],
        "子": ["文昌贵人", "天厨贵人"],
    },
    "壬": {
        "卯": ["天乙贵人"],
        "丑": ["金舆"],
        "巳": ["天乙贵人", "太极贵人"],
        "申": ["太极贵人"],
        "未": ["国印贵人"],
        "寅": ["文昌贵人", "天厨贵人"],
        "辰": ["福星贵人"],
    },
    "癸": {
        "卯": ["天乙贵人", "文昌贵人", "天乙贵人", "福星贵人"],
        "巳": ["天乙贵人", "太极贵人"],
        "申": ["太极贵人", "国印贵人"],
        "寅": ["金舆"],
        "丑": ["福星贵人"],
    },
}
# 月支 > 天干 神煞
yuezhi_tiangan_relations = {
    "子": {"申": ["天德合"], "壬": ["月德贵人"], "丁": ["月德合"]},
    "丑": {"庚": ["天德贵人", "月德贵人"], "乙": ["天德合", "月德合"]},
    "寅": {"丙": ["月德贵人"], "丁": ["天德贵人"], "壬": ["天德合"], "辛": ["月德合"]},
    "卯": {"甲": ["月德贵人"], "申": ["天德贵人"], "巳": ["天德合"], "己": ["月德合"]},
    "辰": {"壬": ["天德贵人"], "丁": ["天德合", "月德合"]},
    "巳": {"丙": ["天德合"], "庚": ["月德贵人"], "辛": ["天德贵人"], "乙": ["月德合"]},
    "午": {"丙": ["月德贵人"], "亥": ["天德贵人"], "辛": ["月德合"]},
    "未": {
        "甲": ["天德贵人", "月德贵人"],
        "己": ["天德合", "月德合"],
    },
    "申": {"戊": ["天德合"], "壬": ["月德贵人"], "癸": ["天德贵人"], "丁": ["月德合"]},
    "酉": {"亥": ["天德合"], "庚": ["月德贵人"], "寅": ["天德贵人"], "乙": ["月德合"]},
    "戌": {"辛": ["天德合"], "丙": ["天德贵人", "月德贵人"]},
    "亥": {"庚": ["天德合"], "甲": ["月德贵人"], "乙": ["天德贵人"], "己": ["月德合"]},
}

# 月支 日柱 神煞
yuezhi_rizhu_relations = {
    "寅": {
        "戊寅": ["天赦日"],
        "庚申": ["四废"],
        "辛酉": ["四废"],
        "乙卯": ["天转"],
        "辛卯": ["地转"],
    },
    "卯": {
        "戊寅": ["天赦日"],
        "庚申": ["四废"],
        "辛酉": ["四废"],
        "乙卯": ["天转"],
        "辛卯": ["地转"],
    },
    "辰": {
        "戊寅": ["天赦日"],
        "庚申": ["四废"],
        "辛酉": ["四废"],
        "乙卯": ["天转"],
        "辛卯": ["地转"],
    },
    "巳": {
        "甲午": ["天赦日"],
        "壬子": ["四废"],
        "癸亥": ["四废"],
        "丙午": ["天转"],
        "戊午": ["地转"],
    },
    "午": {
        "甲午": ["天赦日"],
        "壬子": ["四废"],
        "癸亥": ["四废"],
        "丙午": ["天转"],
        "戊午": ["地转"],
    },
    "未": {
        "甲午": ["天赦日"],
        "壬子": ["四废"],
        "癸亥": ["四废"],
        "丙午": ["天转"],
        "戊午": ["地转"],
    },
    "申": {
        "戊申": ["天赦日"],
        "甲寅": ["四废"],
        "乙卯": ["四废"],
        "辛酉": ["天转"],
        "癸酉": ["地转"],
    },
    "酉": {
        "戊申": ["天赦日"],
        "甲寅": ["四废"],
        "乙卯": ["四废"],
        "辛酉": ["天转"],
        "癸酉": ["地转"],
    },
    "戌": {
        "戊申": ["天赦日"],
        "甲寅": ["四废"],
        "乙卯": ["四废"],
        "辛酉": ["天转"],
        "癸酉": ["地转"],
    },
    "亥": {
        "甲子": ["天赦日"],
        "丙午": ["四废"],
        "丁巳": ["四废"],
        "壬子": ["天转"],
        "丙子": ["地转"],
    },
    "子": {
        "甲子": ["天赦日"],
        "丙午": ["四废"],
        "丁巳": ["四废"],
        "壬子": ["天转"],
        "丙子": ["地转"],
    },
    "丑": {
        "甲子": ["天赦日"],
        "丙午": ["四废"],
        "丁巳": ["四废"],
        "壬子": ["天转"],
        "丙子": ["地转"],
    },
}
# 月支 > 地支 神煞

yuezhi_dizhi_relations = {
    "寅": {"丑": ["天医", "血刃"]},
    "卯": {"寅": ["天医"], "未": ["血刃"]},
    "辰": {"卯": ["天医"], "寅": ["血刃"]},
    "巳": {"辰": ["天医"], "申": ["血刃"]},
    "午": {"巳": ["天医"], "卯": ["血刃"]},
    "未": {"午": ["天医"], "酉": ["血刃"]},
    "酉": {"申": ["天医"], "戌": ["血刃"]},
    "戌": {"酉": ["天医"], "巳": ["血刃"]},
    "亥": {"戌": ["天医"], "亥": ["血刃"]},
    "子": {"亥": ["天医"], "午": ["血刃"]},
    "丑": {"子": ["天医", "血刃"]},
    "申": {"辰": ["血刃"]},
}

# 年支 > 地支 神煞
nianzhi_dizhi_relations = {
    "寅": {
        "申": ["驿马星"],
        "午": ["将星"],
        "戌": ["华盖"],
        "子": ["灾煞", "吊客"],
        "亥": ["劫煞", "绞煞", "披麻"],
        "巳": ["亡神", "孤辰", "勾煞"],
        "卯": ["桃花"],
        "丑": ["寡宿", "红鸾"],
        "未": ["天喜"],
    },
    "午": {
        "申": ["驿马星", "孤辰", "丧门"],
        "午": ["将星"],
        "戌": ["华盖"],
        "子": ["灾煞"],
        "亥": ["劫煞"],
        "巳": ["亡神"],
        "卯": ["桃花", "天喜", "绞煞", "披麻"],
        "辰": ["寡宿", "吊客"],
        "酉": ["红鸾", "勾煞"],
    },
    "戌": {
        "申": ["驿马星", "吊客"],
        "午": ["将星"],
        "戌": ["华盖"],
        "子": ["灾煞", "丧门"],
        "亥": ["劫煞", "孤辰", "天喜"],
        "巳": ["亡神", "红鸾"],
        "卯": ["桃花"],
        "未": ["寡宿", "绞煞", "披麻"],
        "丑": ["勾煞"],
    },
    "申": {
        "寅": ["驿马星"],
        "子": ["将星"],
        "辰": ["华盖"],
        "午": ["灾煞", "吊客"],
        "巳": ["劫煞", "绞煞", "披麻"],
        "亥": ["亡神", "孤辰", "勾煞"],
        "酉": ["桃花"],
        "未": ["寡宿", "红鸾"],
        "丑": ["天喜"],
        "戌": ["丧门"],
    },
    "子": {
        "寅": ["驿马星", "孤辰", "丧门"],
        "子": ["将星"],
        "辰": ["华盖"],
        "午": ["灾煞"],
        "巳": ["劫煞"],
        "亥": ["亡神"],
        "酉": ["桃花", "天喜", "绞煞", "披麻"],
        "戌": ["寡宿", "吊客"],
        "卯": ["红鸾", "勾煞"],
    },
    "辰": {
        "寅": ["驿马星", "吊客"],
        "子": ["将星"],
        "辰": ["华盖"],
        "午": ["灾煞", "丧门"],
        "巳": ["劫煞", "孤辰", "天喜"],
        "亥": ["亡神", "红鸾"],
        "酉": ["桃花"],
        "丑": ["寡宿", "绞煞", "披麻"],
        "未": ["勾煞"],
    },
    "亥": {
        "巳": ["驿马星"],
        "卯": ["将星"],
        "未": ["华盖"],
        "酉": ["灾煞", "吊客"],
        "申": ["劫煞", "绞煞", "披麻"],
        "寅": ["亡神", "孤辰", "勾煞"],
        "子": ["桃花"],
        "戌": ["寡宿", "天喜"],
        "辰": ["红鸾", "丧门"],
        "丑": ["丧门"],
    },
    "卯": {
        "巳": ["驿马星", "孤辰", "丧门"],
        "卯": ["将星"],
        "未": ["华盖"],
        "酉": ["灾煞"],
        "申": ["劫煞"],
        "寅": ["亡神"],
        "子": ["桃花", "红鸾", "绞煞", "披麻"],
        "丑": ["寡宿", "吊客"],
        "午": ["天喜", "勾煞"],
    },
    "未": {
        "巳": ["驿马星", "吊客"],
        "卯": ["将星"],
        "未": ["华盖"],
        "酉": ["灾煞", "丧门"],
        "申": ["劫煞", "孤辰", "红鸾"],
        "寅": ["亡神", "天喜"],
        "子": ["桃花"],
        "辰": ["寡宿", "绞煞", "披麻"],
        "戌": ["勾煞"],
    },
    "巳": {
        "酉": ["将星"],
        "丑": ["华盖"],
        "寅": ["劫煞", "绞煞", "披麻"],
        "申": ["亡神", "孤辰", "勾煞"],
        "午": ["桃花"],
        "辰": ["寡宿", "天喜"],
        "戌": ["红鸾"],
        "未": ["丧门"],
        "卯": ["吊客"],
    },
    "酉": {
        "酉": ["将星"],
        "丑": ["华盖"],
        "寅": ["劫煞"],
        "申": ["亡神"],
        "午": ["桃花", "红鸾", "绞煞", "披麻"],
        "亥": ["孤辰", "丧门"],
        "未": ["寡宿", "吊客"],
        "子": ["天喜", "勾煞"],
    },
    "丑": {
        "酉": ["将星"],
        "未": ["华盖"],
        "丑": ["华盖"],
        "寅": ["劫煞", "孤辰", "红鸾"],
        "申": ["亡神", "天喜"],
        "午": ["桃花"],
        "戌": ["寡宿", "绞煞", "披麻"],
        "辰": ["勾煞"],
        "卯": ["丧门"],
        "亥": ["吊客"],
    },
}

# 日支 > 地支 神煞
rizhi_dizhi_relations = {
    "寅": {
        "申": ["驿马星"],
        "午": ["将星"],
        "戌": ["华盖"],
        "亥": ["劫煞"],
        "巳": ["亡神"],
        "卯": ["桃花"],
    },
    "午": {
        "申": ["驿马星"],
        "午": ["将星"],
        "戌": ["华盖"],
        "亥": ["劫煞"],
        "巳": ["亡神"],
        "卯": ["桃花"],
    },
    "戌": {
        "申": ["驿马星"],
        "午": ["将星"],
        "戌": ["华盖"],
        "亥": ["劫煞"],
        "巳": ["亡神"],
        "卯": ["桃花"],
    },
    "申": {
        "寅": ["驿马星"],
        "子": ["将星"],
        "辰": ["华盖"],
        "巳": ["劫煞"],
        "亥": ["亡神"],
        "酉": ["桃花"],
    },
    "子": {
        "寅": ["驿马星"],
        "子": ["将星"],
        "辰": ["华盖"],
        "巳": ["劫煞"],
        "亥": ["亡神"],
        "酉": ["桃花"],
    },
    "辰": {
        "寅": ["驿马星"],
        "子": ["将星"],
        "辰": ["华盖"],
        "巳": ["劫煞"],
        "亥": ["亡神"],
        "酉": ["桃花"],
    },
    "亥": {
        "巳": ["驿马星"],
        "卯": ["将星"],
        "未": ["华盖"],
        "申": ["劫煞"],
        "寅": ["亡神"],
        "子": ["桃花"],
    },
    "卯": {
        "巳": ["驿马星"],
        "卯": ["将星"],
        "未": ["华盖"],
        "申": ["劫煞"],
        "寅": ["亡神"],
        "子": ["桃花"],
    },
    "未": {
        "巳": ["驿马星"],
        "卯": ["将星"],
        "未": ["华盖"],
        "申": ["劫煞"],
        "寅": ["亡神"],
        "子": ["桃花"],
    },
    "巳": {
        "酉": ["将星"],
        "丑": ["华盖"],
        "寅": ["劫煞"],
        "申": ["亡神"],
        "午": ["桃花"],
    },
    "酉": {
        "酉": ["将星"],
        "丑": ["华盖"],
        "寅": ["劫煞"],
        "申": ["亡神"],
        "午": ["桃花"],
    },
    "丑": {
        "酉": ["将星"],
        "丑": ["华盖"],
        "寅": ["劫煞"],
        "申": ["亡神"],
        "午": ["桃花"],
    },
}

rizhu_dizhi_relations = {
    "甲子": {"戌": ["空亡"], "亥": ["空亡"]},
    "乙丑": {"戌": ["空亡"], "亥": ["空亡"]},
    "丙寅": {"戌": ["空亡"], "亥": ["空亡"]},
    "丁卯": {"戌": ["空亡"], "亥": ["空亡"]},
    "戊辰": {"戌": ["空亡"], "亥": ["空亡"]},
    "己巳": {"戌": ["空亡"], "亥": ["空亡"]},
    "庚午": {"戌": ["空亡"], "亥": ["空亡"]},
    "辛未": {"戌": ["空亡"], "亥": ["空亡"]},
    "壬申": {"戌": ["空亡"], "亥": ["空亡"]},
    "癸酉": {"戌": ["空亡"], "亥": ["空亡"]},
    "甲戌": {"申": ["空亡"], "酉": ["空亡"]},
    "乙亥": {"申": ["空亡"], "酉": ["空亡"]},
    "丙子": {"申": ["空亡"], "酉": ["空亡"]},
    "丁丑": {"申": ["空亡"], "酉": ["空亡"]},
    "戊寅": {"申": ["空亡"], "酉": ["空亡"]},
    "己卯": {"申": ["空亡"], "酉": ["空亡"]},
    "庚辰": {"申": ["空亡"], "酉": ["空亡"]},
    "辛巳": {"申": ["空亡"], "酉": ["空亡"]},
    "壬午": {"申": ["空亡"], "酉": ["空亡"]},
    "癸未": {"申": ["空亡"], "酉": ["空亡"]},
    "甲申": {"午": ["空亡"], "未": ["空亡"]},
    "乙酉": {"午": ["空亡"], "未": ["空亡"]},
    "丙戌": {"午": ["空亡"], "未": ["空亡"]},
    "丁亥": {"午": ["空亡"], "未": ["空亡"]},
    "戊子": {"午": ["空亡"], "未": ["空亡"]},
    "己丑": {"午": ["空亡"], "未": ["空亡"]},
    "庚寅": {"午": ["空亡"], "未": ["空亡"]},
    "辛卯": {"午": ["空亡"], "未": ["空亡"]},
    "壬辰": {"午": ["空亡"], "未": ["空亡"]},
    "癸巳": {"午": ["空亡"], "未": ["空亡"]},
    "甲午": {"辰": ["空亡"], "巳": ["空亡"]},
    "乙未": {"辰": ["空亡"], "巳": ["空亡"]},
    "丙申": {"辰": ["空亡"], "巳": ["空亡"]},
    "丁酉": {"辰": ["空亡"], "巳": ["空亡"]},
    "戊戌": {"辰": ["空亡"], "巳": ["空亡"]},
    "己亥": {"辰": ["空亡"], "巳": ["空亡"]},
    "庚子": {"辰": ["空亡"], "巳": ["空亡"]},
    "辛丑": {"辰": ["空亡"], "巳": ["空亡"]},
    "壬寅": {"辰": ["空亡"], "巳": ["空亡"]},
    "癸卯": {"辰": ["空亡"], "巳": ["空亡"]},
    "甲辰": {"寅": ["空亡"], "卯": ["空亡"]},
    "乙巳": {"寅": ["空亡"], "卯": ["空亡"]},
    "丙午": {"寅": ["空亡"], "卯": ["空亡"]},
    "丁未": {"寅": ["空亡"], "卯": ["空亡"]},
    "戊申": {"寅": ["空亡"], "卯": ["空亡"]},
    "己酉": {"寅": ["空亡"], "卯": ["空亡"]},
    "庚戌": {"寅": ["空亡"], "卯": ["空亡"]},
    "辛亥": {"寅": ["空亡"], "卯": ["空亡"]},
    "壬子": {"寅": ["空亡"], "卯": ["空亡"]},
    "癸丑": {"寅": ["空亡"], "卯": ["空亡"]},
    "甲寅": {"子": ["空亡"], "丑": ["空亡"]},
    "乙卯": {"子": ["空亡"], "丑": ["空亡"]},
    "丙辰": {"子": ["空亡"], "丑": ["空亡"]},
    "丁巳": {"子": ["空亡"], "丑": ["空亡"]},
    "戊午": {"子": ["空亡"], "丑": ["空亡"]},
    "己未": {"子": ["空亡"], "丑": ["空亡"]},
    "庚申": {"子": ["空亡"], "丑": ["空亡"]},
    "辛酉": {"子": ["空亡"], "丑": ["空亡"]},
    "壬戌": {"子": ["空亡"], "丑": ["空亡"]},
    "癸亥": {"子": ["空亡"], "丑": ["空亡"]},
}

nianzhu_dizhi_relations = {
    "甲子": {"戌": ["空亡"], "亥": ["空亡"]},
    "乙丑": {"戌": ["空亡"], "亥": ["空亡"]},
    "丙寅": {"戌": ["空亡"], "亥": ["空亡"]},
    "丁卯": {"戌": ["空亡"], "亥": ["空亡"]},
    "戊辰": {"戌": ["空亡"], "亥": ["空亡"]},
    "己巳": {"戌": ["空亡"], "亥": ["空亡"]},
    "庚午": {"戌": ["空亡"], "亥": ["空亡"]},
    "辛未": {"戌": ["空亡"], "亥": ["空亡"]},
    "壬申": {"戌": ["空亡"], "亥": ["空亡"]},
    "癸酉": {"戌": ["空亡"], "亥": ["空亡"]},
    "甲戌": {"申": ["空亡"], "酉": ["空亡"]},
    "乙亥": {"申": ["空亡"], "酉": ["空亡"]},
    "丙子": {"申": ["空亡"], "酉": ["空亡"]},
    "丁丑": {"申": ["空亡"], "酉": ["空亡"]},
    "戊寅": {"申": ["空亡"], "酉": ["空亡"]},
    "己卯": {"申": ["空亡"], "酉": ["空亡"]},
    "庚辰": {"申": ["空亡"], "酉": ["空亡"]},
    "辛巳": {"申": ["空亡"], "酉": ["空亡"]},
    "壬午": {"申": ["空亡"], "酉": ["空亡"]},
    "癸未": {"申": ["空亡"], "酉": ["空亡"]},
    "甲申": {"午": ["空亡"], "未": ["空亡"]},
    "乙酉": {"午": ["空亡"], "未": ["空亡"]},
    "丙戌": {"午": ["空亡"], "未": ["空亡"]},
    "丁亥": {"午": ["空亡"], "未": ["空亡"]},
    "戊子": {"午": ["空亡"], "未": ["空亡"]},
    "己丑": {"午": ["空亡"], "未": ["空亡"]},
    "庚寅": {"午": ["空亡"], "未": ["空亡"]},
    "辛卯": {"午": ["空亡"], "未": ["空亡"]},
    "壬辰": {"午": ["空亡"], "未": ["空亡"]},
    "癸巳": {"午": ["空亡"], "未": ["空亡"]},
    "甲午": {"辰": ["空亡"], "巳": ["空亡"]},
    "乙未": {"辰": ["空亡"], "巳": ["空亡"]},
    "丙申": {"辰": ["空亡"], "巳": ["空亡"]},
    "丁酉": {"辰": ["空亡"], "巳": ["空亡"]},
    "戊戌": {"辰": ["空亡"], "巳": ["空亡"]},
    "己亥": {"辰": ["空亡"], "巳": ["空亡"]},
    "庚子": {"辰": ["空亡"], "巳": ["空亡"]},
    "辛丑": {"辰": ["空亡"], "巳": ["空亡"]},
    "壬寅": {"辰": ["空亡"], "巳": ["空亡"]},
    "癸卯": {"辰": ["空亡"], "巳": ["空亡"]},
    "甲辰": {"寅": ["空亡"], "卯": ["空亡"]},
    "乙巳": {"寅": ["空亡"], "卯": ["空亡"]},
    "丙午": {"寅": ["空亡"], "卯": ["空亡"]},
    "丁未": {"寅": ["空亡"], "卯": ["空亡"]},
    "戊申": {"寅": ["空亡"], "卯": ["空亡"]},
    "己酉": {"寅": ["空亡"], "卯": ["空亡"]},
    "庚戌": {"寅": ["空亡"], "卯": ["空亡"]},
    "辛亥": {"寅": ["空亡"], "卯": ["空亡"]},
    "壬子": {"寅": ["空亡"], "卯": ["空亡"]},
    "癸丑": {"寅": ["空亡"], "卯": ["空亡"]},
    "甲寅": {"子": ["空亡"], "丑": ["空亡"]},
    "乙卯": {"子": ["空亡"], "丑": ["空亡"]},
    "丙辰": {"子": ["空亡"], "丑": ["空亡"]},
    "丁巳": {"子": ["空亡"], "丑": ["空亡"]},
    "戊午": {"子": ["空亡"], "丑": ["空亡"]},
    "己未": {"子": ["空亡"], "丑": ["空亡"]},
    "庚申": {"子": ["空亡"], "丑": ["空亡"]},
    "辛酉": {"子": ["空亡"], "丑": ["空亡"]},
    "壬戌": {"子": ["空亡"], "丑": ["空亡"]},
    "癸亥": {"子": ["空亡"], "丑": ["空亡"]},
}

rizhu_shensha = {
    "丙子": ["阴差阳错"],
    "丙午": ["阴差阳错", "孤煞寡", "六秀日"],
    "丁丑": ["阴差阳错"],
    "丁未": ["阴差阳错", "六秀日", "八专"],
    "戊寅": ["阴差阳错"],
    "戊申": ["阴差阳错", "孤煞寡"],
    "辛卯": ["阴差阳错", "九丑日"],
    "辛酉": ["阴差阳错", "八专", "九丑日"],
    "壬辰": ["阴差阳错", "魁罡"],
    "壬戌": ["阴差阳错"],
    "癸巳": ["阴差阳错"],
    "癸亥": ["阴差阳错", "十恶大败"],
    "戊戌": ["魁罡", "十恶大败", "八专"],
    "庚辰": ["魁罡", "十恶大败"],
    "庚戌": ["魁罡", "十灵日"],
    "甲寅": ["孤煞寡", "八专"],
    "乙巳": ["孤煞寡", "十恶大败"],
    "丁巳": ["孤煞寡"],
    "戊午": ["孤煞寡", "十灵日", "六秀日", "九丑日"],
    "辛亥": ["孤煞寡", "十灵日"],
    "壬子": ["孤煞寡", "九丑日"],
    "甲辰": ["十恶大败", "十灵日"],
    "壬申": ["十恶大败"],
    "丙申": ["十恶大败"],
    "丁亥": ["十恶大败"],
    "辛巳": ["十恶大败"],
    "己丑": ["十恶大败", "六秀日"],
    "乙丑": ["金神"],
    "己巳": ["金神"],
    "癸酉": ["金神"],
    "乙亥": ["十灵日"],
    "丙辰": ["十灵日"],
    "丁酉": ["十灵日", "九丑日"],
    "庚寅": ["十灵日"],
    "壬寅": ["十灵日"],
    "癸未": ["十灵日"],
    "戊子": ["六秀日", "九丑日"],
    "己未": ["六秀日", "八专"],
    "乙卯": ["八专"],
    "庚申": ["八专"],
    "癸丑": ["八专"],
    "己卯": ["九丑日"],
    "己酉": ["九丑日"],
    "壬午": ["九丑日"],
}

shizhu_shensha = {
    "乙丑": ["金神"],
    "己巳": ["金神"],
    "癸酉": ["金神"],
}


def calculate_simple_bazi(year, month, day, hour):
    current_time = datetime(year, month, day, hour)
    if hour == 23:
        day_add = 1
        hour_add = -23
    else:
        day_add = 0
        hour_add = 0
    day = sxtwl.fromSolar(year, month, day + day_add)
    ytg = day.getYearGZ()
    mtg = day.getMonthGZ()
    dtg = day.getDayGZ()
    htg = day.getHourGZ(hour + hour_add)
    mtg_index = mtg.tg
    mdz_index = mtg.dz
    if day.hasJieQi() and day.getJieQi() in jieqi_names:
        # print('节气：%s'% jqmc[day.getJieQi()])
        # 获取节气的儒略日数
        jd = day.getJieQiJD()
        # 将儒略日数转换成年月日时秒
        t = sxtwl.JD2DD(jd)
        jieqi_time = datetime(year, month, day, int(t.h), int(t.m))
        bazi_time = current_time
        if bazi_time < jieqi_time:
            mtg_index = (mtg_index - 1 + 10) % 10
            mdz_index = (mdz_index - 1 + 12) % 12

    nian_gan = Gan[ytg.tg]
    nian_zhi = Zhi[ytg.dz]
    yue_gan = Gan[mtg_index]
    yue_zhi = Zhi[mdz_index]
    ri_gan = Gan[dtg.tg]
    ri_zhi = Zhi[dtg.dz]
    shi_gan = Gan[htg.tg]
    shi_zhi = Zhi[htg.dz]
    bazi_info = {
        "nian_ganzhi": nian_gan + nian_zhi,
        "yue_ganzhi": yue_gan + yue_zhi,
        "ri_ganzhi": ri_gan + ri_zhi,
        "shi_ganzhi": shi_gan + shi_zhi,
    }
    return bazi_info


def get_zhi_xiang_wei(zhis):
    ret = ""
    ben_min_di_zhis = zhis
    for current_di_zhi in ben_min_di_zhis:
        if current_di_zhi == "子":
            if "丑" in ben_min_di_zhis:
                msg = "子丑化合土;"
                if msg not in ret:
                    ret += msg
                if "亥" in ben_min_di_zhis:
                    msg = "亥子丑三会水局;"
                    if msg not in ret:
                        ret += msg
            if "午" in ben_min_di_zhis:
                msg = "子午冲;"
                if msg not in ret:
                    ret += msg
            if "未" in ben_min_di_zhis:
                msg = "子未穿;"
                if msg not in ret:
                    ret += msg
            if "卯" in ben_min_di_zhis:
                msg = "子卯破;"
                if msg not in ret:
                    ret += msg
            if "申" in ben_min_di_zhis:
                if "辰" in ben_min_di_zhis:
                    msg = "申子辰三合水;"
                    if msg not in ret:
                        ret += msg
                else:
                    msg = "申子半合水;"
                    if msg not in ret:
                        ret += msg
            if "辰" in ben_min_di_zhis:
                msg = "子辰半合水;"
                if msg not in ret:
                    ret += msg
        elif "丑" in ben_min_di_zhis:
            if "未" in ben_min_di_zhis:
                msg = "丑未冲;"
                if msg not in ret:
                    ret += msg
                if "戌" in ben_min_di_zhis:
                    msg = "丑未戌相刑;"
                    if msg not in ret:
                        ret += msg
            if "午" in ben_min_di_zhis:
                msg = "午丑穿;"
                if msg not in ret:
                    ret += msg
            if "寅" in ben_min_di_zhis:
                msg = "寅丑暗合;"
                if msg not in ret:
                    ret += msg
            if "酉" in ben_min_di_zhis:
                msg = "酉丑半合金局;"
                if msg not in ret:
                    ret += msg
                if "巳" in ben_min_di_zhis:
                    msg = "巳酉丑三合金局;"
                    if msg not in ret:
                        ret += msg
            if "巳" in ben_min_di_zhis and "酉" in ret:
                msg = "巳丑拱酉;"
                if msg not in ret:
                    ret += msg

    return ret


def _add_msg_to_ret(gans, target_gan, message, ret):
    if target_gan in gans and message not in ret:
        ret += message
    return ret


def get_gan_xiang_wei(gans):
    ret = ""

    for current_gan in gans:
        if current_gan == "甲":
            ret = _add_msg_to_ret(gans, "己", "甲己合化土;", ret)
            ret = _add_msg_to_ret(gans, "己", "甲克己;", ret)
            ret = _add_msg_to_ret(gans, "戊", "甲克戊;", ret)
            ret = _add_msg_to_ret(gans, "庚", "甲庚冲;", ret)
            ret = _add_msg_to_ret(gans, "丙", "甲生丙;", ret)
            ret = _add_msg_to_ret(gans, "丁", "甲生丁;", ret)
        elif current_gan == "乙":
            ret = _add_msg_to_ret(gans, "庚", "乙庚合化金;", ret)
            ret = _add_msg_to_ret(gans, "辛", "乙辛冲;", ret)
            ret = _add_msg_to_ret(gans, "丙", "乙生丙;", ret)
            ret = _add_msg_to_ret(gans, "丁", "乙生丁;", ret)
            ret = _add_msg_to_ret(gans, "戊", "乙克戊;", ret)
            ret = _add_msg_to_ret(gans, "己", "乙克己;", ret)
        elif current_gan == "丙":
            ret = _add_msg_to_ret(gans, "辛", "丙辛合化水;", ret)
            ret = _add_msg_to_ret(gans, "壬", "丙壬冲;", ret)
            ret = _add_msg_to_ret(gans, "戊", "丙生戊;", ret)
            ret = _add_msg_to_ret(gans, "己", "丙生己;", ret)
            ret = _add_msg_to_ret(gans, "庚", "丙克庚;", ret)
            ret = _add_msg_to_ret(gans, "辛", "丙克辛;", ret)
        elif current_gan == "丁":
            ret = _add_msg_to_ret(gans, "壬", "丁壬合化木;", ret)
            ret = _add_msg_to_ret(gans, "癸", "丁癸冲;", ret)
            ret = _add_msg_to_ret(gans, "戊", "丁生戊;", ret)
            ret = _add_msg_to_ret(gans, "己", "丁生己;", ret)
            ret = _add_msg_to_ret(gans, "庚", "丁克庚;", ret)
            ret = _add_msg_to_ret(gans, "辛", "丁克辛;", ret)
        elif current_gan == "戊":
            ret = _add_msg_to_ret(gans, "癸", "戊癸合化火;", ret)
            ret = _add_msg_to_ret(gans, "庚", "戊生庚;", ret)
            ret = _add_msg_to_ret(gans, "辛", "戊生辛;", ret)
            ret = _add_msg_to_ret(gans, "壬", "戊克壬;", ret)
            ret = _add_msg_to_ret(gans, "癸", "戊克癸;", ret)


def get_tiangan_dizhi_relations(tian_gan, dizhi):
    dizhi_shui = ["子", "亥"]
    dizhi_mu = ["卯", "寅"]
    dizhi_huo = ["午", "巳"]
    dizhi_tu = ["丑", "辰", "未", "戌"]
    dizhi_jin = ["酉", "申"]
    tiangan_shui = ["癸", "壬"]
    tiangan_mu = ["乙", "甲"]
    tiangan_huo = ["丁", "丙"]
    tiangan_tu = ["己", "戊"]
    tiangan_jin = ["辛", "庚"]
    if tian_gan in tiangan_jin:
        if dizhi in dizhi_jin:
            if tiangan_jin.index(tian_gan) == dizhi_jin.index(dizhi):
                return "比肩"
            else:
                return "劫财"
        elif dizhi in dizhi_mu:
            if tiangan_jin.index(tian_gan) == dizhi_mu.index(dizhi):
                return "偏财"
            else:
                return "正财"
        elif dizhi in dizhi_shui:
            if tiangan_jin.index(tian_gan) == dizhi_shui.index(dizhi):
                return "食神"
            else:
                return "伤官"
        elif dizhi in dizhi_huo:
            if tiangan_jin.index(tian_gan) == dizhi_huo.index(dizhi):
                return "七杀"
            else:
                return "正官"
        elif dizhi in dizhi_tu:
            if (tiangan_jin.index(tian_gan) % 2) == (dizhi_tu.index(dizhi) % 2):
                return "偏印"
            else:
                return "正印"
    elif tian_gan in tiangan_mu:
        if dizhi in dizhi_jin:
            if tiangan_mu.index(tian_gan) == dizhi_jin.index(dizhi):
                return "七杀"
            else:
                return "正官"
        elif dizhi in dizhi_mu:
            if tiangan_mu.index(tian_gan) == dizhi_mu.index(dizhi):
                return "比肩"
            else:
                return "劫财"
        elif dizhi in dizhi_shui:
            if tiangan_mu.index(tian_gan) == dizhi_shui.index(dizhi):
                return "偏印"
            else:
                return "正印"
        elif dizhi in dizhi_huo:
            if tiangan_mu.index(tian_gan) == dizhi_huo.index(dizhi):
                return "食神"
            else:
                return "伤官"
        elif dizhi in dizhi_tu:
            if (tiangan_mu.index(tian_gan) % 2) == (dizhi_tu.index(dizhi) % 2):
                return "偏财"
            else:
                return "正财"
    elif tian_gan in tiangan_shui:
        if dizhi in dizhi_jin:
            if tiangan_shui.index(tian_gan) == dizhi_jin.index(dizhi):
                return "偏印"
            else:
                return "正印"
        elif dizhi in dizhi_mu:
            if tiangan_shui.index(tian_gan) == dizhi_mu.index(dizhi):
                return "食神"
            else:
                return "伤官"
        elif dizhi in dizhi_shui:
            if tiangan_shui.index(tian_gan) == dizhi_shui.index(dizhi):
                return "比肩"
            else:
                return "劫财"
        elif dizhi in dizhi_huo:
            if tiangan_shui.index(tian_gan) == dizhi_huo.index(dizhi):
                return "偏财"
            else:
                return "正财"
        elif dizhi in dizhi_tu:
            if (tiangan_shui.index(tian_gan) % 2) == (dizhi_tu.index(dizhi) % 2):
                return "七杀"
            else:
                return "正官"
    elif tian_gan in tiangan_huo:
        if dizhi in dizhi_jin:
            if tiangan_huo.index(tian_gan) == dizhi_jin.index(dizhi):
                return "偏财"
            else:
                return "正财"
        elif dizhi in dizhi_mu:
            if tiangan_huo.index(tian_gan) == dizhi_mu.index(dizhi):
                return "偏印"
            else:
                return "正印"
        elif dizhi in dizhi_shui:
            if tiangan_huo.index(tian_gan) == dizhi_shui.index(dizhi):
                return "七杀"
            else:
                return "正官"
        elif dizhi in dizhi_huo:
            if tiangan_huo.index(tian_gan) == dizhi_huo.index(dizhi):
                return "比肩"
            else:
                return "劫财"
        elif dizhi in dizhi_tu:
            if (tiangan_huo.index(tian_gan) % 2) == (dizhi_tu.index(dizhi) % 2):
                return "食神"
            else:
                return "伤官"
    elif tian_gan in tiangan_tu:
        if dizhi in dizhi_jin:
            if tiangan_tu.index(tian_gan) == dizhi_jin.index(dizhi):
                return "食神"
            else:
                return "伤官"
        elif dizhi in dizhi_mu:
            if tiangan_tu.index(tian_gan) == dizhi_mu.index(dizhi):
                return "七杀"
            else:
                return "正官"
        elif dizhi in dizhi_shui:
            if tiangan_tu.index(tian_gan) == dizhi_shui.index(dizhi):
                return "偏财"
            else:
                return "正财"
        elif dizhi in dizhi_huo:
            if tiangan_tu.index(tian_gan) == dizhi_huo.index(dizhi):
                return "偏印"
            else:
                return "正印"
        elif dizhi in dizhi_tu:
            if (tiangan_tu.index(tian_gan) % 2) == (dizhi_tu.index(dizhi) % 2):
                return "比肩"
            else:
                return "劫财"


def get_relation_abbreviation(relation_name):
    if relation_name == "七杀":
        return "杀"
    if relation_name == "正官":
        return "官"
    if relation_name == "偏印":
        return "枭"
    if relation_name == "正印":
        return "印"
    if relation_name == "食神":
        return "食"
    if relation_name == "伤官":
        return "伤"
    if relation_name == "比肩":
        return "比"
    if relation_name == "劫财":
        return "劫"
    if relation_name == "偏财":
        return "才"
    if relation_name == "正财":
        return "财"


def calculate_yunshi_shensha(
    nian_zhu, yue_zhu, ri_zhu, shi_zhu, gender, yunshiGz, natal_shensha_list
):
    # 先计算用年柱来推算的神煞
    nian_gan = nian_zhu[0]
    nian_zhi = nian_zhu[1]
    yue_gan = yue_zhu[0]
    yue_zhi = yue_zhu[1]
    ri_gan = ri_zhu[0]
    ri_zhi = ri_zhu[1]
    shi_gan = shi_zhu[0]
    shi_zhi = shi_zhu[1]
    yunshi_gan = yunshiGz[0]
    yunshi_zhi = yunshiGz[1]

    clock_wise = True
    if gender == 0:
        # 年支为偶数 则为阳年
        if Zhi.index(nian_zhi) % 2 == 0:
            clock_wise = False
    else:
        if Zhi.index(nian_zhi) % 2 == 0:
            clock_wise = True

    shen_sha_list = []
    # 以年柱为太极点找神煞
    # 以年干推各支
    shen_sha_list.extend(niangan_dizhi_relations[nian_gan].get(yunshi_zhi, []))
    # 以年支推各支
    shen_sha_list.extend(nianzhi_dizhi_relations[nian_zhi].get(yunshi_zhi, []))
    # 以年柱推各支
    shen_sha_list.extend(nianzhu_dizhi_relations[nian_zhu].get(yunshi_zhi, []))
    # 以月柱为太极点找神煞
    # 以月支推各支
    shen_sha_list.extend(yuezhi_dizhi_relations[yue_zhi].get(yunshi_zhi, []))
    # 以月支推各干
    shen_sha_list.extend(yuezhi_tiangan_relations[yue_zhi].get(yunshi_gan, []))
    # 以日柱为太极点推算
    shen_sha_list.extend(rigan_dizhi_relations[ri_gan].get(yunshi_zhi, []))
    shen_sha_list.extend(rizhi_dizhi_relations[ri_zhi].get(yunshi_zhi, []))
    shen_sha_list.extend(rizhu_dizhi_relations[ri_zhu].get(yunshi_zhi, []))

    bazi_list = [nian_zhu, yue_zhu, ri_zhu, shi_zhu]
    for shen_sha in shen_sha_list:
        if shen_sha == "勾煞":
            if not clock_wise:
                index = shen_sha_list.index("勾煞")
                shen_sha_list[index] = "绞煞"
        if shen_sha == "绞煞":
            if not clock_wise:
                index = shen_sha_list.index("绞煞")
                shen_sha_list[index] = "勾煞"

    # 计算元辰
    clock_wise_yuanchen = {
        "子": "未",
        "丑": "申",
        "寅": "酉",
        "卯": "戌",
        "辰": "亥",
        "巳": "子",
        "午": "丑",
        "未": "寅",
        "申": "卯",
        "酉": "辰",
        "戌": "巳",
        "亥": "午",
    }

    clock_unwise_yuanchen = {
        "子": "巳",
        "丑": "午",
        "寅": "未",
        "卯": "申",
        "辰": "酉",
        "巳": "戌",
        "午": "亥",
        "未": "子",
        "申": "丑",
        "酉": "寅",
        "戌": "卯",
        "亥": "辰",
    }

    if clock_wise:
        target = clock_wise_yuanchen[nian_zhi]
        if yunshi_zhi == target:
            shen_sha_list.append("元辰")
    else:
        target = clock_unwise_yuanchen[nian_zhi]
        if yunshi_zhi == target:
            shen_sha_list.append("元辰")

    # 计算德秀贵人
    if yue_zhi in ["寅", "午", "戌"]:
        if "丙" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] or "丁" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
        ]:
            if "戊" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] and "癸" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                shen_sha_list.append("德秀贵人")
    if yue_zhi in ["申", "子", "辰"]:
        if (
            "壬" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
            or "癸" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
            or "戊" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
            or "己" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
        ):
            if (
                "丙" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
                and "辛" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
            ) or (
                "甲" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
                and "己" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan]
            ):
                if "德秀贵人" not in natal_shensha_list:
                    shen_sha_list.append("德秀贵人")
    if yue_zhi in ["巳", "酉", "丑"]:
        if "庚" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] or "辛" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
        ]:
            if "乙" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] and "庚" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                if "德秀贵人" not in natal_shensha_list:
                    shen_sha_list.append("德秀贵人")
    if yue_zhi in ["亥", "卯", "未"]:
        if "甲" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] or "乙" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
            yunshi_gan,
        ]:
            if "丁" in [nian_gan, yue_gan, ri_gan, shi_gan, yunshi_gan] and "壬" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                if "德秀贵人" not in natal_shensha_list:
                    shen_sha_list.append("德秀贵人")

    # 看学堂词馆（禄命法，以年纳音查月日时支)
    if "金" in nayin_dict[nian_zhu]:
        if yunshi_zhi == "巳":
            shen_sha_list.append("学堂")

    if "木" in nayin_dict[nian_zhu]:
        if yunshi_zhi == "亥":
            shen_sha_list.append("学堂")

    if "水" in nayin_dict[nian_zhu]:
        if yunshi_zhi == "申":
            shen_sha_list.append("学堂")

    if "土" in nayin_dict[nian_zhu]:
        if yunshi_zhi == "申":
            shen_sha_list.append("学堂")

    if "火" in nayin_dict[nian_zhu]:
        if yunshi_zhi == "寅":
            shen_sha_list.append("学堂")

    return shen_sha_list


def calculate_shensha(nian_zhu, yue_zhu, ri_zhu, shi_zhu, gender):
    # 先计算用年柱来推算的神煞
    nian_gan = nian_zhu[0]
    nian_zhi = nian_zhu[1]
    yue_gan = yue_zhu[0]
    yue_zhi = yue_zhu[1]
    ri_gan = ri_zhu[0]
    ri_zhi = ri_zhu[1]
    shi_gan = shi_zhu[0]
    shi_zhi = shi_zhu[1]

    clock_wise = True
    if gender == 0:
        # 年支为偶数 则为阳年
        if Zhi.index(nian_zhi) % 2 == 0:
            clock_wise = False
    else:
        if Zhi.index(nian_zhi) % 2 == 0:
            clock_wise = True

    nian_shen_sha = []
    yue_shen_sha = []
    ri_shen_sha = []
    shi_shen_sha = []
    # 以年柱为太极点找神煞
    # 以年干推各支
    nian_shen_sha.extend(niangan_dizhi_relations[nian_gan].get(nian_zhi, []))
    yue_shen_sha.extend(niangan_dizhi_relations[nian_gan].get(yue_zhi, []))
    ri_shen_sha.extend(niangan_dizhi_relations[nian_gan].get(ri_zhi, []))
    shi_shen_sha.extend(niangan_dizhi_relations[nian_gan].get(shi_zhi, []))
    # 以年支推各支
    yue_shen_sha.extend(nianzhi_dizhi_relations[nian_zhi].get(yue_zhi, []))
    ri_shen_sha.extend(nianzhi_dizhi_relations[nian_zhi].get(ri_zhi, []))
    shi_shen_sha.extend(nianzhi_dizhi_relations[nian_zhi].get(shi_zhi, []))

    # 以年柱推各支
    yue_shen_sha.extend(nianzhu_dizhi_relations[nian_zhu].get(yue_zhi, []))
    yue_shen_sha.extend(nianzhu_dizhi_relations[nian_zhu].get(yue_zhi, []))
    ri_shen_sha.extend(nianzhu_dizhi_relations[nian_zhu].get(ri_zhi, []))
    shi_shen_sha.extend(nianzhu_dizhi_relations[nian_zhu].get(shi_zhi, []))

    # 以月柱为太极点找神煞
    # 以月支推各支
    nian_shen_sha.extend(yuezhi_dizhi_relations[yue_zhi].get(nian_zhi, []))
    ri_shen_sha.extend(yuezhi_dizhi_relations[yue_zhi].get(ri_zhi, []))
    shi_shen_sha.extend(yuezhi_dizhi_relations[yue_zhi].get(shi_zhi, []))
    # 以月支推日柱
    ri_shen_sha.extend(yuezhi_rizhu_relations[yue_zhi].get(ri_zhu, []))
    # 以月支推各干
    nian_shen_sha.extend(yuezhi_tiangan_relations[yue_zhi].get(nian_gan, []))
    yue_shen_sha.extend(yuezhi_tiangan_relations[yue_zhi].get(yue_gan, []))
    ri_shen_sha.extend(yuezhi_tiangan_relations[yue_zhi].get(ri_gan, []))
    shi_shen_sha.extend(yuezhi_tiangan_relations[yue_zhi].get(shi_gan, []))

    # 以日柱为太极点推算
    nian_shen_sha.extend(rigan_dizhi_relations[ri_gan].get(nian_zhi, []))
    yue_shen_sha.extend(rigan_dizhi_relations[ri_gan].get(yue_zhi, []))
    ri_shen_sha.extend(rigan_dizhi_relations[ri_gan].get(ri_zhi, []))
    shi_shen_sha.extend(rigan_dizhi_relations[ri_gan].get(shi_zhi, []))

    nian_shen_sha.extend(rizhi_dizhi_relations[ri_zhi].get(nian_zhi, []))
    yue_shen_sha.extend(rizhi_dizhi_relations[ri_zhi].get(yue_zhi, []))
    shi_shen_sha.extend(rizhi_dizhi_relations[ri_zhi].get(shi_zhi, []))

    nian_shen_sha.extend(rizhu_dizhi_relations[ri_zhu].get(nian_zhi, []))
    yue_shen_sha.extend(rizhu_dizhi_relations[ri_zhu].get(yue_zhi, []))
    shi_shen_sha.extend(rizhu_dizhi_relations[ri_zhu].get(shi_zhi, []))

    # 推算日柱的神煞
    ri_shen_sha.extend(rizhu_shensha.get(ri_zhu, []))
    # 推算时柱的神煞
    shi_shen_sha.extend(shizhu_shensha.get(shi_zhu, []))

    bazi_list = [nian_zhu, yue_zhu, ri_zhu, shi_zhu]
    shen_sha_list = [nian_shen_sha, yue_shen_sha, ri_shen_sha, shi_shen_sha]
    for shen_shas in shen_sha_list:
        for shen_sha in shen_shas:
            if shen_sha == "勾煞":
                if not clock_wise:
                    index = shen_shas.index("勾煞")
                    shen_shas[index] = "绞煞"
            if shen_sha == "绞煞":
                if not clock_wise:
                    index = shen_shas.index("绞煞")
                    shen_shas[index] = "勾煞"

            if shen_sha == "羊刃":
                current_zhu = shen_sha_list.index(shen_shas)
                current_zhi = bazi_list[current_zhu][1]
                current_zhi_index = Zhi.index(current_zhi)
                if abs(Zhi.index(nian_zhi) - current_zhi_index) == 6:
                    nian_shen_sha.append("飞刃")
                if abs(Zhi.index(yue_zhi) - current_zhi_index) == 6:
                    yue_shen_sha.append("飞刃")
                if abs(Zhi.index(ri_zhi) - current_zhi_index) == 6:
                    ri_shen_sha.append("飞刃")
                if abs(Zhi.index(shi_zhi) - current_zhi_index) == 6:
                    shi_shen_sha.append("飞刃")

    # 计算天罗地网
    if "火" in nayin_dict[nian_zhu]:
        if ri_zhi in ["戌", "亥"]:
            ri_shen_sha.append("天罗")
    if "水" in nayin_dict[nian_zhu] or "土" in nayin_dict[nian_zhu]:
        if ri_zhi in ["辰", "巳"]:
            ri_shen_sha.append("地网")

    # 计算元辰
    clock_wise_yuanchen = {
        "子": "未",
        "丑": "申",
        "寅": "酉",
        "卯": "戌",
        "辰": "亥",
        "巳": "子",
        "午": "丑",
        "未": "寅",
        "申": "卯",
        "酉": "辰",
        "戌": "巳",
        "亥": "午",
    }

    clock_unwise_yuanchen = {
        "子": "巳",
        "丑": "午",
        "寅": "未",
        "卯": "申",
        "辰": "酉",
        "巳": "戌",
        "午": "亥",
        "未": "子",
        "申": "丑",
        "酉": "寅",
        "戌": "卯",
        "亥": "辰",
    }

    if clock_wise:
        target = clock_wise_yuanchen[nian_zhi]
        if yue_zhi == target:
            yue_shen_sha.append("元辰")
        if ri_zhi == target:
            ri_shen_sha.append("元辰")
        if shi_zhi == target:
            shi_shen_sha.append("元辰")
    else:
        target = clock_unwise_yuanchen[nian_zhi]
        if yue_zhi == target:
            yue_shen_sha.append("元辰")
        if ri_zhi == target:
            ri_shen_sha.append("元辰")
        if shi_zhi == target:
            shi_shen_sha.append("元辰")

    # 计算德秀贵人
    if yue_zhi in ["寅", "午", "戌"]:
        if "丙" in [nian_gan, yue_gan, ri_gan, shi_gan] or "丁" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
        ]:
            if "戊" in [nian_gan, yue_gan, ri_gan, shi_gan] and "癸" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                yue_shen_sha.append("德秀贵人")
    if yue_zhi in ["申", "子", "辰"]:
        if (
            "壬" in [nian_gan, yue_gan, ri_gan, shi_gan]
            or "癸" in [nian_gan, yue_gan, ri_gan, shi_gan]
            or "戊" in [nian_gan, yue_gan, ri_gan, shi_gan]
            or "己" in [nian_gan, yue_gan, ri_gan, shi_gan]
        ):
            if (
                "丙" in [nian_gan, yue_gan, ri_gan, shi_gan]
                and "辛" in [nian_gan, yue_gan, ri_gan, shi_gan]
            ) or (
                "甲" in [nian_gan, yue_gan, ri_gan, shi_gan]
                and "己" in [nian_gan, yue_gan, ri_gan, shi_gan]
            ):
                yue_shen_sha.append("德秀贵人")
    if yue_zhi in ["巳", "酉", "丑"]:
        if "庚" in [nian_gan, yue_gan, ri_gan, shi_gan] or "辛" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
        ]:
            if "乙" in [nian_gan, yue_gan, ri_gan, shi_gan] and "庚" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                yue_shen_sha.append("德秀贵人")
    if yue_zhi in ["亥", "卯", "未"]:
        if "甲" in [nian_gan, yue_gan, ri_gan, shi_gan] or "乙" in [
            nian_gan,
            yue_gan,
            ri_gan,
            shi_gan,
        ]:
            if "丁" in [nian_gan, yue_gan, ri_gan, shi_gan] and "壬" in [
                nian_gan,
                yue_gan,
                ri_gan,
                shi_gan,
            ]:
                yue_shen_sha.append("德秀贵人")

    # 计算拱禄
    if (
        (ri_zhu == "癸亥" and shi_zhu == "癸丑")
        or (ri_zhu == "癸丑" and shi_zhu == "癸亥")
        or (ri_zhu == "丁巳" and shi_zhu == "丁未")
        or (ri_zhu == "己未" and shi_zhu == "己巳")
        or (ri_zhu == "戊辰" and shi_zhu == "戊午")
    ):
        ri_shen_sha.append("拱禄")

    # 判断童子煞
    if yue_zhi in ["寅", "卯", "辰"] or yue_zhi in ["巳", "午", "未"]:
        if ri_zhi in ["寅", "子"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["寅", "子"]:
            shi_shen_sha.append("童子煞")
    if yue_zhi in ["亥", "子", "丑"] or yue_zhi in ["巳", "午", "未"]:
        if ri_zhi in ["卯", "未", "辰"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["卯", "未", "辰"]:
            shi_shen_sha.append("童子煞")
    if "金" in nayin_dict[nian_zhu] or "木" in nayin_dict[nian_zhu]:
        if ri_zhi in ["午"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["午"]:
            shi_shen_sha.append("童子煞")
        if ri_zhi in ["卯"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["卯"]:
            shi_shen_sha.append("童子煞")
    if "水" in nayin_dict[nian_zhu] or "火" in nayin_dict[nian_zhu]:
        if ri_zhi in ["酉"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["酉"]:
            shi_shen_sha.append("童子煞")
        if ri_zhi in ["戌"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["戌"]:
            shi_shen_sha.append("童子煞")
    if "土" in nayin_dict[nian_zhu]:
        if ri_zhi in ["辰"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["辰"]:
            shi_shen_sha.append("童子煞")
        if ri_zhi in ["巳"]:
            ri_shen_sha.append("童子煞")
        if shi_zhi in ["巳"]:
            shi_shen_sha.append("童子煞")

    # 看学堂词馆（禄命法，以年纳音查月日时支)
    if "金" in nayin_dict[nian_zhu]:
        if yue_zhi == "巳":
            yue_shen_sha.append("学堂")
        if ri_zhi == "巳":
            ri_shen_sha.append("学堂")
        if shi_zhi == "巳":
            shi_shen_sha.append("学堂")

    if "木" in nayin_dict[nian_zhu]:
        if yue_zhi == "亥":
            yue_shen_sha.append("学堂")
        if ri_zhi == "亥":
            ri_shen_sha.append("学堂")
        if shi_zhi == "亥":
            shi_shen_sha.append("学堂")

    if "水" in nayin_dict[nian_zhu]:
        if yue_zhi == "申":
            yue_shen_sha.append("学堂")
        if ri_zhi == "申":
            ri_shen_sha.append("学堂")
        if shi_zhi == "申":
            shi_shen_sha.append("学堂")

    if "土" in nayin_dict[nian_zhu]:
        if yue_zhi == "申":
            yue_shen_sha.append("学堂")
        if ri_zhi == "申":
            ri_shen_sha.append("学堂")
        if shi_zhi == "申":
            shi_shen_sha.append("学堂")

    if "火" in nayin_dict[nian_zhu]:
        if yue_zhi == "寅":
            yue_shen_sha.append("学堂")
        if ri_zhi == "寅":
            ri_shen_sha.append("学堂")
        if shi_zhi == "寅":
            shi_shen_sha.append("学堂")

    nian_shen_sha = list(set(nian_shen_sha))
    yue_shen_sha = list(set(yue_shen_sha))
    ri_shen_sha = list(set(ri_shen_sha))
    shi_shen_sha = list(set(shi_shen_sha))

    return nian_shen_sha, yue_shen_sha, ri_shen_sha, shi_shen_sha


def get_rigan_relation(riGan, ganZhi):
    nian_gan_shishen = tiangan_relations[riGan][ganZhi[0]]
    nian_zhi_shishen = get_tiangan_dizhi_relations(riGan, ganZhi[1])
    shishen = get_relation_abbreviation(nian_gan_shishen) + get_relation_abbreviation(
        nian_zhi_shishen
    )
    return shishen


def get_jieqi_change_day_list(year):
    jie_qi_list = []
    day = sxtwl.fromLunar(year, 1, 1)
    while day.getLunarYear() != (year + 1):
        if day.hasJieQi():
            jieqi_time = "{}.{}".format(day.getSolarMonth(), day.getSolarDay())
            jie_qi_list.append(jieqi_time)

        day = day.after(1)

    final_jieqi_list = []
    for i in range(len(jie_qi_list)):
        if i % 2 == 0:
            final_jieqi_list.append(jie_qi_list[i])
    return final_jieqi_list


def calculate_bazi_relations(bazi):
    """
    Calculate the relationships between elements in a BaZi (Eight Characters).

    Parameters:
    - bazi: A list of strings representing the BaZi. Example: ["癸酉", "己未", "辛丑", "戊子"]

    Returns:
    - A dict with relationship information.
    """
    # Predefined relationships
    # Extracting elements
    niangan, nianzhi, yuegan, yuezhi, rigan, rizhi, shigan, shizhi = [
        bazi[0][0],
        bazi[0][1],
        bazi[1][0],
        bazi[1][1],
        bazi[2][0],
        bazi[2][1],
        bazi[3][0],
        bazi[3][1],
    ]

    # Initialize the result dict
    relations = {
        "niangan": [],
        "nianzhi": [],
        "yuegan": [],
        "yuezhi": [],
        "rizhi": [],
        "rigan": [],
        "shigan": [],
        "shizhi": [],
    }

    # 计算天干
    gans = [niangan, yuegan, rigan, shigan]
    bazi_pos = [[niangan, yuegan, rigan, shigan], [nianzhi, yuezhi, rizhi, shizhi]]
    for x in range(4):
        current_gan = gans[x]
        if x == 0:
            current_gan_type = "niangan"
        elif x == 1:
            current_gan_type = "yuegan"
        elif x == 2:
            current_gan_type = "rigan"
        elif x == 3:
            current_gan_type = "shigan"
        for y in range(4):
            if x == y:
                continue
            compare_gan = gans[y]
            if y == 0:
                compare_gan_type = "niangan"
            elif y == 1:
                compare_gan_type = "yuegan"
            elif y == 2:
                compare_gan_type = "rigan"
            elif y == 3:
                compare_gan_type = "shigan"
            if (
                current_gan in gan_relations
                and compare_gan in gan_relations[current_gan]
            ):
                relation_list = gan_relations[current_gan][compare_gan]
                for relation in relation_list:
                    relations[current_gan_type].append(
                        {"relation_target": compare_gan_type, "relation_type": relation}
                    )
            relations[current_gan_type].append(
                {
                    "relation_target": compare_gan_type,
                    "relation_type": shengke_dict[current_gan][compare_gan],
                }
            )

    # 计算地支
    zhis = [nianzhi, yuezhi, rizhi, shizhi]
    for x in range(4):
        current_zhi = zhis[x]
        compared_zhis = copy.deepcopy(zhis)
        if x == 0:
            current_zhi_type = "nianzhi"
        elif x == 1:
            current_zhi_type = "yuezhi"
        elif x == 2:
            current_zhi_type = "rizhi"
        elif x == 3:
            current_zhi_type = "shizhi"
        for y in range(4):
            if x == y:
                continue
            compare_zhi = compared_zhis[y]
            if y == 0:
                compare_zhi_type = "nianzhi"
            elif y == 1:
                compare_zhi_type = "yuezhi"
            elif y == 2:
                compare_zhi_type = "rizhi"
            elif y == 3:
                compare_zhi_type = "shizhi"
            if (
                current_zhi in zhi_relations
                and compare_zhi in zhi_relations[current_zhi]
            ):
                relation_list = zhi_relations[current_zhi][compare_zhi]
                for relation in relation_list:
                    relations[current_zhi_type].append(
                        {"relation_target": compare_zhi_type, "relation_type": relation}
                    )

    # 两个坐标，一个是y轴一个是x
    for y in range(2):
        for x in range(4):
            curent_pos = (y, x)
            current_char = bazi_pos[y][x]
            current_pos_type = pos_dict[curent_pos]
            pos_dict_copy = pos_dict.copy()
            pos_dict_copy.pop(curent_pos)
            compared_pos_dict = pos_dict_copy
            for pos_mapper in compared_pos_dict:
                compared_y = pos_mapper[0]
                compared_x = pos_mapper[1]
                compared_char = bazi_pos[compared_y][compared_x]
                compared_pos_type = compared_pos_dict[pos_mapper]
                relation_name = shengke_dict[current_char][compared_char]
                relations[current_pos_type].append(
                    {
                        "relation_target": compared_pos_type,
                        "relation_type": relation_name,
                    }
                )

    return relations


def get_earthly_branch_time(born_time):
    # 判断 born_time 是否为字符串格式
    if isinstance(born_time, str):
        # 尝试将字符串解析为 datetime 对象
        try:
            # Using datetime.strptime instead of fromisoformat for more flexible parsing
            born_time = datetime.strptime(born_time, '%Y-%m-%d %H:%M')
        except ValueError:
            try:
                # Try with fromisoformat as fallback for proper ISO format strings
                born_time = datetime.fromisoformat(born_time)
            except ValueError:
                raise ValueError("Invalid datetime string format")
    # 提取小时
    hour = born_time.hour

    # 根据小时判断对应的地支时辰
    if 23 <= hour or hour < 1:
        return "子时"
    elif 1 <= hour < 3:
        return "丑时"
    elif 3 <= hour < 5:
        return "寅时"
    elif 5 <= hour < 7:
        return "卯时"
    elif 7 <= hour < 9:
        return "辰时"
    elif 9 <= hour < 11:
        return "巳时"
    elif 11 <= hour < 13:
        return "午时"
    elif 13 <= hour < 15:
        return "未时"
    elif 15 <= hour < 17:
        return "申时"
    elif 17 <= hour < 19:
        return "酉时"
    elif 19 <= hour < 21:
        return "戌时"
    elif 21 <= hour < 23:
        return "亥时"


def get_solar_time(date_time, longitude: float, timezone: float) -> datetime:
    # 如果传入的 date_time 是字符串格式，自动转换为 datetime 对象
    if isinstance(date_time, str):
        try:
            if date_time.count(":") == 1:
                date_time = datetime.strptime(date_time, "%Y-%m-%d %H:%M")
            else:
                date_time = datetime.strptime(date_time, "%Y-%m-%d %H:%M:%S")
        except ValueError:
            raise ValueError("日期时间格式应为 'YYYY-MM-DD HH:MM:SS'")

    if not isinstance(timezone, float):
        timezone = float(timezone)

    year = date_time.year
    day_of_year = (date_time - datetime(date_time.year, 1, 1)).days + 1

    # 计算 theta 和 deltaT
    N0 = 79.6764 + 0.2422 * (year - 1985) - int(0.25 * (year - 1985))
    theta = 2 * math.pi * (day_of_year - N0) / 365.2422
    deltaT = (
        0.0028
        - 1.9857 * math.sin(theta)
        + 9.9059 * math.sin(2 * theta)
        - 7.0924 * math.cos(theta)
        - 0.6882 * math.cos(2 * theta)
    )

    # 根据传入的 float 时区值计算 shiQu
    shiQu = timezone * 15  # 时区每小时对应15度经度

    # 计算平太阳时
    ping = (longitude - shiQu) * 4  # 每度经度差异对应4分钟
    zheng = date_time + timedelta(seconds=int(ping * 60 + deltaT * 60))

    return zheng



def get_full_bazi_info(born_time, gender, timezone, born_lon, yunshi_time=None):
    beijing_info = get_bazi_natal_info(
        born_time, gender, timezone, born_lon, yunshi_time=yunshi_time
    )
    born_time_solar = get_solar_time(born_time, born_lon, timezone)
    if (
        get_earthly_branch_time(born_time) == get_earthly_branch_time(born_time_solar)
    ) and int(timezone) == 8:
        solar_info = beijing_info
    else:
        solar_info = get_bazi_natal_info(
            born_time,
            gender,
            timezone,
            born_lon,
            yunshi_time=yunshi_time,
            cal_solar=True,
        )

    return {"beijing_info": beijing_info, "solar_info": solar_info}
    # else:
    #     return {"common_info":beijing_info}


def get_simple_bazi_info(cal_time, timezoneOffset):
    china_timezone_offset = 8
    timezone_gap = china_timezone_offset - timezoneOffset
    # 换算成中国出生时间
    cal_time = cal_time + timedelta(hours=timezone_gap)
    if cal_time.hour == 23:
        day_add = 1
        hour_add = -23
    else:
        day_add = 0
        hour_add = 0
    day = sxtwl.fromSolar(cal_time.year, cal_time.month, cal_time.day + day_add)
    yTG = day.getYearGZ()
    mTG = day.getMonthGZ()
    dTG = day.getDayGZ()
    hTG = day.getHourGZ(cal_time.hour + hour_add)
    mtg_index = mTG.tg
    mdz_index = mTG.dz

    if day.hasJieQi():
        # print('节气：%s'% jqmc[day.getJieQi()])
        # 获取节气的儒略日数
        jd = day.getJieQiJD()
        # 将儒略日数转换成年月日时秒
        t = sxtwl.JD2DD(jd)
        jieqi_time = datetime(
            cal_time.year, cal_time.month, cal_time.day, int(t.h), int(t.m)
        )
        bazi_time = cal_time
        if bazi_time < jieqi_time:
            mtg_index = (mtg_index - 1 + 10) % 10
            mdz_index = (mdz_index - 1 + 12) % 12

    nianGan = Gan[yTG.tg]
    nianZhi = Zhi[yTG.dz]
    yueGan = Gan[mtg_index]
    yueZhi = Zhi[mdz_index]
    riGan = Gan[dTG.tg]
    riZhi = Zhi[dTG.dz]
    shiGan = Gan[hTG.tg]
    shiZhi = Zhi[hTG.dz]
    return nianGan + nianZhi, yueGan + yueZhi, riGan + riZhi, shiGan + shiZhi


import sxtwl
from datetime import datetime


def calculate_bazi(year, month, day, hour, minute, calZaoZi=False, includeYunShi=True):
    # 开始计时
    start_time = datetime.now()

    # 处理子时跨日
    day_add = 0
    hour_add = 0
    if not calZaoZi:
        if hour == 23:
            day_add = 1
            hour_add = -23

    # 初始化天干地支列表
    Gan = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]
    Zhi = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

    # 获取日期实例
    day_instance = sxtwl.fromSolar(year, month, day + day_add)

    # 获取年月日时的干支
    yearGz = day_instance.getYearGZ(False)  # 年干支
    monthGz = day_instance.getMonthGZ()  # 月干支
    dayGz = day_instance.getDayGZ()  # 日干支
    hourGz = day_instance.getHourGZ(hour + hour_add)  # 时干支

    # 获取干支索引
    nianTgIndex = yearGz.tg
    nianDzIndex = yearGz.dz
    yueTgIndex = monthGz.tg
    yueDzIndex = monthGz.dz
    riTgIndex = dayGz.tg
    riDzIndex = dayGz.dz
    shiTgIndex = hourGz.tg
    shiDzIndex = hourGz.dz

    # 处理节气
    current_time = datetime(year, month, day, hour, minute)

    if day_instance.hasJieQi():
        # 获取节气的儒略日数
        jd = day_instance.getJieQiJD()
        # 将儒略日数转换成年月日时分
        t = sxtwl.JD2DD(jd)
        jieqi_time = datetime(year, month, day, int(t.h), int(t.m))

        # 判断是否在节气时间点之前
        if current_time < jieqi_time:
            # 获取前一天的干支
            prev_day = day_instance.before(1)
            prev_yearGz = prev_day.getYearGZ(False)
            prev_monthGz = prev_day.getMonthGZ()

            # 更新干支索引
            nianTgIndex = prev_yearGz.tg
            nianDzIndex = prev_yearGz.dz
            yueTgIndex = prev_monthGz.tg
            yueDzIndex = prev_monthGz.dz

    # 转换成汉字
    result = {
        "niangan": Gan[nianTgIndex],
        "nianzhi": Zhi[nianDzIndex],
        "yuegan": Gan[yueTgIndex],
        "yuezhi": Zhi[yueDzIndex],
        "rigan": Gan[riTgIndex],
        "rizhi": Zhi[riDzIndex],
        "shigan": Gan[shiTgIndex],
        "shizhi": Zhi[shiDzIndex],
    }
    return result


def get_bazi_natal_info(
    born_time, gender, timezoneOffset, born_lon, yunshi_time=None, cal_solar=False
):
    if isinstance(born_time, str):
        born_time_str = born_time
        if born_time_str.count(":") > 1:
            born_time_str = born_time_str[:-3]
        born_time = datetime.strptime(born_time_str, "%Y-%m-%d %H:%M")
    origin_time = born_time
    solar_time = get_solar_time(origin_time, born_lon, timezoneOffset)
    china_timezone_offset = 8
    timezone_gap = china_timezone_offset - timezoneOffset
    # 换算成中国出生时间

    beijing_time = born_time + timedelta(hours=timezone_gap)
    ret = calculate_bazi(
        beijing_time.year,
        beijing_time.month,
        beijing_time.day,
        beijing_time.hour,
        beijing_time.minute,
    )
    nianGan = ret["niangan"]
    nianZhi = ret["nianzhi"]
    yueGan = ret["yuegan"]
    yueZhi = ret["yuezhi"]

    cal_shi_time = beijing_time
    if cal_solar:
        cal_shi_time = solar_time

    shi_ret = calculate_bazi(
        cal_shi_time.year,
        cal_shi_time.month,
        cal_shi_time.day,
        cal_shi_time.hour,
        cal_shi_time.minute,
    )
    riGan = shi_ret["rigan"]
    riZhi = shi_ret["rizhi"]
    shiGan = shi_ret["shigan"]
    shiZhi = shi_ret["shizhi"]

    # 地支藏干
    # 子(0)里藏癸(9) 丑(1)藏己(5)癸(9)辛(7) 寅(2)藏甲(0)丙(2)戊(10) 卯(3)藏乙(1) 辰(4)藏戊(4)乙(1)癸(9) 巳(5)藏丙(2)庚(6)戊(4)\
    # 午(6)藏丁(3)己(5) 未(7)藏己(5)丁(3)乙(1) 申(8)藏庚(6)壬(8)戊(4) 酉(9)藏辛(7) 戌(10)藏戊(4)辛(7)丁(3) 亥(11)藏壬(8)甲(0)
    # 同性同元素为比肩 异性同元素为劫财 同性克我者为七杀 异性克我者为正官 同性生我者为偏印 异性生我者为正印 同性我克者为偏财 异性我克者为正财
    # 十神规律没找到
    # 年干阳男/年干阴女 大运顺排
    # 年干阴男/年干阴女 大运逆排
    # 按照规则：
    # 年干阳男/年干阴女 大运顺排
    # 年干阴男/年干阴女 大运逆排
    clockwise = (Gan.index(nianGan) + gender) % 2 != 0
    day = sxtwl.fromSolar(beijing_time.year,beijing_time.month,beijing_time.day)
    # 查找某日前后的第一个jieling,此例为之后，之前把after替换成before
    while True:
        day = day.after(1) if clockwise else day.before(1)
        if day.hasJieQi():
            # logger.debug('节气：%s' % jqmc[day.getJieQi()])
            jd = day.getJieQiJD()
            jq_index = day.getJieQi()
            if jq_index % 2 != 0:
                t = sxtwl.JD2DD(jd)
                break
            # logger.debug("节气时间:%d-%d-%d %d:%d:%d" % (t.Y, t.M, t.D, t.h, t.m, round(t.s)))
    if yunshi_time:
        # 排大运
        jieqi = datetime(int(t.Y), int(t.M), int(t.D), int(t.h), int(t.m))
        # 时间差 三天等于365天 则1天等于 365/3天
        # 也就是说 1*24*60*60 = 1*24*60*60
        gap = jieqi - born_time
        jieqi_gap = abs((gap.seconds + gap.days * (24 * 60 * 60)) * 365 / 3)
        # 起运年份是 一年是 365*24*60*60秒
        gap_years = jieqi_gap // (365 * 24 * 60 * 60)
        gap_month = (jieqi_gap - gap_years * 365 * 24 * 60 * 60) // (30 * 24 * 60 * 60)
        gap_days = (
            jieqi_gap
            - gap_years * (365 * 24 * 60 * 60)
            - gap_month * (30 * 24 * 60 * 60)
        ) // (24 * 60 * 60)
        qi_yun_msg = "出生后%s年%s个月%s起运" % (
            int(gap_years),
            int(gap_month),
            str(int(gap_days)) + "天" if gap_days else "",
        )
        # 大运第一年
        dayun_change_time = born_time + timedelta(seconds=jieqi_gap)
        # 第一个小运额外处理
        dayun_list = []
        if dayun_change_time.year != born_time.year:
            info = {}
            info["year"] = born_time.year
            info["wuxing"] = yueGan + yueZhi
            gan_relation = tiangan_relations[riGan][yueGan]
            zhi_relation = get_tiangan_dizhi_relations(riGan, yueZhi)
            relations = get_relation_abbreviation(
                gan_relation
            ) + get_relation_abbreviation(zhi_relation)
            info["shishen"] = relations
            dayun_list.append(info)
        # 排8个大运
        if clockwise:
            index_increase = 1
        else:
            index_increase = -1
        tg_index = Gan.index(yueGan)
        dz_index = Zhi.index(yueZhi)
        for i in range(9):
            tg_index = tg_index + index_increase
            dz_index = dz_index + index_increase
            tg_index = (tg_index) % 10
            dz_index = (dz_index) % 12
            tianGan = Gan[tg_index]
            diZhi = Zhi[dz_index]
            wuxing = tianGan + diZhi
            info = {}
            info["wuxing"] = wuxing
            info["year"] = dayun_change_time.year + (10 * i)
            info["shishen"] = get_rigan_relation(riGan, wuxing)
            dayun_list.append(info)

        liunian_list = []
        for i in range(0, 100):
            info = {}
            ytg_index = (Gan.index(nianGan) + i) % 10
            ydz_index = (Zhi.index(nianZhi) + i) % 12
            nianGan_tmp = Gan[ytg_index]
            nianZhi_tmp = Zhi[ydz_index]
            nian_wuxing = nianGan_tmp + nianZhi_tmp
            info["wuxing"] = nian_wuxing
            shishen = get_rigan_relation(riGan, nian_wuxing)
            info["shishen"] = shishen
            info["year"] = born_time.year + i
            liuyue_list = []
            mtg_index = tiangan_start_map.get(ytg_index, None) % 10
            for mdz_index in range(2, 14):
                mgz = Gan[(mtg_index + mdz_index - 2) % 10] + Zhi[mdz_index % 12]
                info_tmp = {}
                info_tmp["wuxing"] = mgz
                info_tmp["shishen"] = get_rigan_relation(riGan, mgz)
                # print("index 1 ")
                # print(born_time.year + i)
                # print("index 2 ")
                # print(mdz_index - 2)
                jieqi_day = jieqi_days[born_time.year + i][mdz_index - 2]
                info_tmp["day"] = jieqi_day
                liuyue_list.append(info_tmp)
            info["liuyue_list"] = liuyue_list
            liunian_list.append(info)
        current_index = 0
        for x in range(len(dayun_list)):
            if x != len(dayun_list) - 1:
                next_year = dayun_list[x + 1]["year"]
            else:
                next_year = dayun_list[x]["year"] + 10

            for y in range(current_index, 100):
                if liunian_list[y]["year"] < next_year:
                    if "liunian_list" not in dayun_list[x]:
                        dayun_list[x]["liunian_list"] = [liunian_list[y]]
                    else:
                        dayun_list[x]["liunian_list"].append(liunian_list[y])
                else:
                    current_index = y
                    break
        dayun_len = len(dayun_list)
        yunshi_bazi = get_simple_bazi_info(yunshi_time, 8)
        dayun_wuxing = None
        for x in range(dayun_len):
            if dayun_wuxing != None:
                break
            dayun = dayun_list[x]
            dayun_year = dayun["year"]
            if (
                x != dayun_len - 1
                and yunshi_time.year >= dayun_year
                and yunshi_time.year < dayun_list[x + 1]["year"]
            ) or (x == dayun_len - 1):
                liunian_list = dayun_list[x]["liunian_list"]
                liunian_len = len(liunian_list)
                for y in range(liunian_len):
                    liunian = liunian_list[y]
                    liunian_wuxin = liunian["wuxing"]
                    if yunshi_bazi[0] == liunian_wuxin:
                        liuyue_list = liunian_list[y]["liuyue_list"]
                        liuyue_len = len(liuyue_list)
                        for z in range(liuyue_len):
                            liuyue = liuyue_list[z]
                            liuyue_wuxin = liuyue["wuxing"]
                            if liuyue_wuxin == yunshi_bazi[1]:
                                dayun_wuxing = dayun["wuxing"]

    bazi_info = {}
    bazi_info["niangan"] = nianGan
    bazi_info["nianzhi"] = nianZhi
    bazi_info["yuegan"] = yueGan
    bazi_info["yuezhi"] = yueZhi
    bazi_info["rigan"] = riGan
    bazi_info["rizhi"] = riZhi
    bazi_info["shigan"] = shiGan
    bazi_info["shizhi"] = shiZhi
    all_shensha_list = list(
        calculate_shensha(
            nianGan + nianZhi, yueGan + yueZhi, riGan + riZhi, shiGan + shiZhi, gender
        )
    )
    bazi_info["nianzhu_shensha_list"] = all_shensha_list[0]
    bazi_info["yuezhu_shensha_list"] = all_shensha_list[1]
    bazi_info["rizhu_shensha_list"] = all_shensha_list[2]
    bazi_info["shizhu_shensha_list"] = all_shensha_list[3]
    if yunshi_time:
        bazi_info["dayun_wuxing"] = dayun_wuxing
    
    shieshen_count = {
    "食神": 0,
    "伤官": 0,
    "正财": 0,
    "偏财": 0,
    "正官": 0,
    "七杀": 0,
    "正印": 0,
    "偏印": 0,
    "比肩": 0,
    "劫财": 0,
    }
    for item in [nianGan,yueGan,shiGan]:
        relation = tiangan_relations[riGan][item]
        shieshen_count[relation] += 1
    for item in [nianZhi,yueZhi,riZhi,shiZhi]:
        cang_gan = dizhi_canggan_dict[item][0]
        relation = tiangan_relations[riGan][cang_gan]
        shieshen_count[relation] += 1
    bazi_info["shishen_count"] =  shieshen_count

    return bazi_info


def calculate_bazi_yunshi_dict(
    bazi, gender, dayunGz=None, liunianGz=None, liuyueGz=None, liuriGz=None
):
    niangan = bazi[0]
    nianzhi = bazi[1]
    yuegan = bazi[2]
    yuezhi = bazi[3]
    rigan = bazi[4]
    rizhi = bazi[5]
    shigan = bazi[6]
    shizhi = bazi[7]
    shensha_list = calculate_shensha(
        niangan + nianzhi, yuegan + yuezhi, rigan + rizhi, shigan + shizhi, gender
    )
    shensha_list = shensha_list[0] + shensha_list[1] + shensha_list[2] + shensha_list[3]
    result_dict = {}
    if dayunGz != None:
        result_dict["dayungan"] = dayunGz[0]
        result_dict["dayunzhi"] = dayunGz[1]
        result_dict["dayunShenShaList"] = calculate_yunshi_shensha(
            niangan + nianzhi,
            yuegan + yuezhi,
            rigan + rizhi,
            shigan + shizhi,
            gender,
            dayunGz,
            shensha_list,
        )
    if liunianGz != None:
        result_dict["liuniangan"] = liunianGz[0]
        result_dict["liunianzhi"] = liunianGz[1]
        result_dict["liunianShenShaList"] = calculate_yunshi_shensha(
            niangan + nianzhi,
            yuegan + yuezhi,
            rigan + rizhi,
            shigan + shizhi,
            gender,
            liunianGz,
            shensha_list,
        )
    if liuyueGz != None:
        result_dict["liuyuegan"] = liuyueGz[0]
        result_dict["liuyuezhi"] = liuyueGz[1]
        result_dict["liuyueShenShaList"] = calculate_yunshi_shensha(
            niangan + nianzhi,
            yuegan + yuezhi,
            rigan + rizhi,
            shigan + shizhi,
            gender,
            liuyueGz,
            shensha_list,
        )
    if liuriGz != None:
        result_dict["liurigan"] = liuriGz[0]
        result_dict["liurizhi"] = liuriGz[1]
        result_dict["liuriShenShaList"] = calculate_yunshi_shensha(
            niangan + nianzhi,
            yuegan + yuezhi,
            rigan + rizhi,
            shigan + shizhi,
            gender,
            liuriGz,
            shensha_list,
        )
    return result_dict


def calculate_two_bazi_relations(bazi1, bazi2):
    """
    Calculate the relationships between elements in a BaZi (Eight Characters).

    Parameters:
    - bazi: A list of strings representing the BaZi. Example: ["癸酉", "己未", "辛丑", "戊子"]

    Returns:
    - A dict with relationship information.
    """
    # Predefined relationships
    # Extracting elements
    niangan1, nianzhi1, yuegan1, yuezhi1, rigan1, rizhi1, shigan1, shizhi1 = [
        bazi1[0][0],
        bazi1[0][1],
        bazi1[1][0],
        bazi1[1][1],
        bazi1[2][0],
        bazi1[2][1],
        bazi1[3][0],
        bazi1[3][1],
    ]
    niangan2, nianzhi2, yuegan2, yuezhi2, rigan2, rizhi2, shigan2, shizhi2 = [
        bazi2[0][0],
        bazi2[0][1],
        bazi2[1][0],
        bazi2[1][1],
        bazi2[2][0],
        bazi2[2][1],
        bazi2[3][0],
        bazi2[3][1],
    ]

    # Initialize the result dict
    achart_relations = {
        "niangan": [],
        "nianzhi": [],
        "yuegan": [],
        "yuezhi": [],
        "rizhi": [],
        "rigan": [],
        "shigan": [],
        "shizhi": [],
    }

    bchart_relations = {
        "niangan": [],
        "nianzhi": [],
        "yuegan": [],
        "yuezhi": [],
        "rizhi": [],
        "rigan": [],
        "shigan": [],
        "shizhi": [],
    }

    # 计算天干
    gans = [niangan1, yuegan1, rigan1, shigan1]
    compared_gans = [niangan2, yuegan2, rigan2, shigan2]
    for x in range(4):
        current_gan = gans[x]
        if x == 0:
            current_gan_type = "niangan"
        elif x == 1:
            current_gan_type = "yuegan"
        elif x == 2:
            current_gan_type = "rigan"
        elif x == 3:
            current_gan_type = "shigan"
        for y in range(4):
            compare_gan = compared_gans[y]
            if y == 0:
                compare_gan_type = "niangan"
            elif y == 1:
                compare_gan_type = "yuegan"
            elif y == 2:
                compare_gan_type = "rigan"
            elif y == 3:
                compare_gan_type = "shigan"
            if (
                current_gan in gan_relations
                and compare_gan in gan_relations[current_gan]
            ):
                relation_list = gan_relations[current_gan][compare_gan]
                for relation in relation_list:
                    achart_relations[current_gan_type].append(
                        {"relation_target": compare_gan_type, "relation_type": relation}
                    )
                    bchart_relations[compare_gan_type].append(
                        {"relation_target": current_gan_type, "relation_type": relation}
                    )

    # 计算地支
    zhis = [nianzhi1, yuezhi1, rizhi1, shizhi1]
    compared_zhis = [nianzhi2, yuezhi2, rizhi2, shizhi2]
    for x in range(4):
        current_zhi = zhis[x]
        if x == 0:
            current_zhi_type = "nianzhi"
        elif x == 1:
            current_zhi_type = "yuezhi"
        elif x == 2:
            current_zhi_type = "rizhi"
        elif x == 3:
            current_zhi_type = "shizhi"
        for y in range(4):
            compare_zhi = compared_zhis[y]
            if y == 0:
                compare_zhi_type = "nianzhi"
            elif y == 1:
                compare_zhi_type = "yuezhi"
            elif y == 2:
                compare_zhi_type = "rizhi"
            elif y == 3:
                compare_zhi_type = "shizhi"
            if (
                current_zhi in zhi_relations
                and compare_zhi in zhi_relations[current_zhi]
            ):
                relation_list = zhi_relations[current_zhi][compare_zhi]
                for relation in relation_list:
                    achart_relations[current_zhi_type].append(
                        {"relation_target": compare_zhi_type, "relation_type": relation}
                    )
                    bchart_relations[compare_zhi_type].append(
                        {"relation_target": current_zhi_type, "relation_type": relation}
                    )
    bazi_pos1 = [
        [niangan1, yuegan1, rigan1, shigan1],
        [nianzhi1, yuezhi1, rizhi1, shizhi1],
    ]
    bazi_pos2 = [
        [niangan2, yuegan2, rigan2, shigan2],
        [nianzhi2, yuezhi2, rizhi2, shizhi2],
    ]
    # 两个坐标，一个是y轴一个是x
    for y in range(2):
        for x in range(4):
            curent_pos = (y, x)
            current_char = bazi_pos1[y][x]
            current_pos_type = pos_dict[curent_pos]
            compared_pos_dict = pos_dict
            for pos_mapper in compared_pos_dict:
                compared_y = pos_mapper[0]
                compared_x = pos_mapper[1]
                compared_char = bazi_pos2[compared_y][compared_x]
                compared_pos = compared_pos_dict[pos_mapper]
                relation_name = shengke_dict[current_char][compared_char]
                achart_relations[current_pos_type].append(
                    {"relation_target": compared_pos, "relation_type": relation_name}
                )
                bchart_relations[compared_pos].append(
                    {
                        "relation_target": current_pos_type,
                        "relation_type": shengke_opposit_dict[relation_name],
                    }
                )

    return achart_relations, bchart_relations


def cal_canggan_shishen_dict(canggan_list):
    benqi = canggan_list[0]
    zhongqi = ""
    yuqi = ""
    if len(canggan_list) >= 2:
        zhongqi = canggan_list[1]
    if len(canggan_list) == 3:
        yuqi = canggan_list[2]

    return {"benqi": benqi, "zhongqi": zhongqi, "yuqi": yuqi}


result = cal_canggan_shishen_dict(["偏印", "七杀", "偏财"])
print(result)


# 计算relation_dict的方法
# relation_dict = {}
# for key in shengke_dict:
#     relation_dict[key] = {}
#     value = shengke_dict[key]
#     for compare in value:
#         relation_dict[key][compare] = [value[compare]]

# for key in relation_dict:
#     if key in gan_relations:
#         value = relation_dict[key]
#         for compare in value:
#             if compare in gan_relations[key]:
#                 relation_dict[key][compare].extend(gan_relations[key][compare])
#     if key in zhi_relations:
#         value = relation_dict[key]
#         for compare in value:
#             if compare in zhi_relations[key]:
#                 relation_dict[key][compare].extend(zhi_relations[key][compare])

# print(relation_dict)

if __name__ == "__main__":
    ret = calculateBazi(1993, 7, 18, 23, 45)
    print(ret)
